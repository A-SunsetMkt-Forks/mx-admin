import{R as d,a as x}from"./index-66557411.js";import{d as c,r,o as m,h as e,N as b,bY as y,b8 as k,b_ as F,J as p,bo as N,U as T,O as B,M as E,al as C,t as D,u as L,bO as S,bP as v}from"./vendor-a7b34205.js";import{X as w}from"./index-8ef61982.js";import{u as U}from"./use-react-1ab208ae.js";import{socket as i}from"./index-fb989de1.js";import{E as h}from"./types-4fa065e6.js";import{b as g}from"./index-77eb1604.js";const M=c({setup(){const s=r([]),l=r(!1),u=async()=>{l.value=!0;const{data:t}=await d.api.health.log.list(a.value).get();s.value=t,l.value=!1};m(()=>{u()});const o=r(""),n=r(!1),a=r("native");return()=>e(B,null,e(N,{transformOrigin:"center",show:n.value,onUpdateShow:t=>void(n.value=t)},e(T,{title:"\u67E5\u770B\u65E5\u5FD7",class:"modal-card !w-[100rem] !bg-dark-400 !text-white !all:text-white ",bordered:!1,closable:!0,onClose:()=>{n.value=!1}},e(R,{data:o.value}))),e(b,{show:l.value},e(y,{class:"min-h-[300px]"},{header(){return e(k,{class:"ml-auto w-32",value:a.value,onUpdateValue:t=>{a.value=t,u()},options:[{label:"PM2",value:"pm2"},{label:"\u7CFB\u7EDF\u8BB0\u5F55",value:"native"}]})},default(){return s.value.map(t=>e(F,{key:t.filename},{default(){return e("div",{class:"flex flex-col"},e("span",null,t.filename),e("span",{class:"text-gray-400 dark:text-gray-600 text-sm grid grid-cols-[5rem,auto]"},e("span",null,t.size),e("span",null,"\u7C7B\u578B\uFF1A",t.type)))},suffix(){return e("div",{class:"flex space-x-2"},e(p,{ghost:!0,type:"success",onClick:()=>{d.api.health.log(a.value).get({params:{filename:t.filename}}).then(f=>{o.value=f,n.value=!0})}},"\u67E5\u770B"),e(p,{ghost:!0,type:"error",onClick:()=>{d.api.health.log(a.value).delete({params:{filename:t.filename}}).then(()=>{s.value.splice(s.value.findIndex(f=>f.filename===t.filename),1)})}},"\u5220\u9664"))}}))}})))}}),R=c({props:{data:{type:String,default:""}},setup(s){const l=r(!0);return m(()=>{setTimeout(()=>{l.value=!1},1e3)}),()=>e("div",{class:"h-[600px] max-h-[70vh] overflow-auto relative"},l.value?e("div",{class:"w-full flex items-center justify-center h-full"},e(b,{show:!0,strokeWidth:14})):e(w,{class:"h-full w-full max-h-full",onReady:u=>{u.write(s.data)}}))}}),O=c({setup(){const s=(a=!0)=>{i.socket.emit("log",{prevLog:a})};let l,u=[];const o=a=>{l?(u.length>0&&n(l),l.write(a)):u.push(a)},n=a=>{for(;u.length;){const t=u.shift();a.write(t)}};return m(()=>{s(),g.on(h.STDOUT,o)}),U(()=>{const a=()=>{s(!1)};return i.socket.io.on("open",a),()=>{i.socket.io.off("open",a)}}),E(()=>{i.socket.emit("unlog"),g.off(h.STDOUT,o)}),()=>e(w,{darkMode:!0,onReady:a=>{l=a,n(l)}})}});var X=c({setup(){const s=C(),l=D(()=>s.query.tab?.toString()||"0"),u=L();return()=>e(x,null,e(S,{size:"medium",value:l.value,onUpdateValue:o=>{u.replace({...s,query:{...s.query,tab:o}})}},e(v,{tab:"\u65E5\u5FD7",name:"0"},e(M,null)),e(v,{tab:"\u5B9E\u65F6",name:"1"},e(O,null))))}});export{X as default};
