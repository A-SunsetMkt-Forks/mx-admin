import{H as P}from"./rounded-button-6a23b45b.js";import{P as U,S as T,M as V,T as $}from"./parse-content-5ae2728a.js";import{E}from"./toggle-dc2d6503.js";import{f as b,j as M,k as B,l as H,m as v,p as W,n as w,R as c,y as r,u as q,x as z,a as t,C as D,F as I,bm as F,I as j,W as A,H as L,bn as O,bo as Y}from"./index-c5b2c6d2.js";import{U as _}from"./underline-input-3d760935.js";import{N as G}from"./DynamicTags-1244b16a.js";import{i as J}from"./isString-ba078331.js";import{N as p}from"./FormItem-4b2417f3.js";import{N as R}from"./Select-e281a637.js";import{N as K}from"./Switch-516f7eb7.js";import"./DynamicInput-021b6fcc.js";import"./ChevronRight-b513c9eb.js";import"./Add-a6216969.js";import"./ButtonGroup-babd82bd.js";import"./InputNumber-d5a92ab8.js";import"./Form-6628a9b5.js";import"./use-async-monaco-449a2dc8.js";import"./index-3d78637a.js";import"./editor.main-8f1dfe4c.js";import"./use-save-confirm-d4cd7785.js";import"./js-yaml-fae8e8ce.js";import"./use-react-cd8ab6a8.js";import"./throttle-6304931b.js";import"./Tag-11275d89.js";import"./prop-46b62c35.js";import"./index-77a21536.js";const Se=b(()=>{const S=M(),u=B(H);v(async()=>{await u.fetch()});const C=()=>({categoryId:u.data?.value?.[0].id??"",slug:"",text:"",title:"",copyright:!0,tags:[],summary:"",allowComment:!0,id:void 0,images:[],meta:void 0}),x=e=>{const l=O(a),n=Object.keys(l);for(const o in e)n.includes(o)&&(a[o]=e[o])},a=W(C()),s=w(()=>S.query.id),d=w(()=>u.get(a.categoryId)||u.data?.value?.[0]||{});v(async()=>{const e=s.value;if(e&&typeof e=="string"){const l=await c.api.posts(e).get();x(l.data)}});const g=r(!1),y=q(),N=z(),k=async()=>{const e={...a,categoryId:d.value.id,summary:a.summary&&a.summary.trim()!=""?a.summary.trim():null};if(s.value){if(!J(s.value))return;const l=s.value;await c.api.posts(l).put({data:e}),y.success("\u4FEE\u6539\u6210\u529F")}else await c.api.posts.post({data:e}),y.success("\u53D1\u5E03\u6210\u529F");N.push({name:Y.ViewPost,hash:"|publish"})};return()=>t(D,{title:s.value?"\u4FEE\u6539\u6587\u7AE0":"\u64B0\u5199\u65B0\u6587\u7AE0",actionsElement:t(I,null,[t(U,{data:a,onHandleYamlParsedMeta:e=>{const{title:l,slug:n,...o}=e;a.title=l??a.title,a.slug=n??a.slug,a.meta={...o}}},null),t(P,{icon:t(F,null,null),onClick:k},null)]),footerButtonElement:t(I,null,[t("button",{onClick:()=>{g.value=!0}},[t(j,null,{default:()=>[t(T,null,null)]})])])},{default:()=>[t(V,{class:"mt-3 relative z-10",label:"\u60F3\u60F3\u53D6\u4E2A\u4EC0\u4E48\u6807\u9898\u597D\u5462~",value:a.title,onChange:e=>{a.title=e}},null),t("div",{class:"text-gray-500 py-3"},[t("label",{class:"prefix"},[`${A}/${d.value.slug}/`]),t(_,{class:"ml-2",value:a.slug,onChange:e=>{a.slug=e}},null)]),t(E,{loading:!!(s.value&&typeof a.id>"u"),onChange:e=>{a.text=e},text:a.text},null),t($,{show:g.value,onUpdateShow:e=>{g.value=e},data:a},{default:()=>[t(p,{label:"\u5206\u7C7B",required:!0,path:"category"},{default:()=>[t(R,{placeholder:"\u8BF7\u9009\u62E9",value:d.value.id,onUpdateValue:e=>{a.categoryId=e},options:u.data.value?.map(e=>({label:e.name,value:e.id,key:e.id}))||[]},null)]}),t(p,{label:"\u6807\u7B7E"},{default:()=>[t(G,{value:a.tags,onUpdateValue:e=>{a.tags.length=0,a.tags.push(...e)}},{input({submit:e}){const l=b({setup(){const n=r([]),o=r(!1),h=r(""),f=r();return v(async()=>{o.value=!0,f.value&&f.value.$el.querySelector("input").focus();const{data:i}=await c.api.categories.get({params:{type:"Tag"}});n.value=i.map(m=>({label:`${m.name} (${m.count})`,value:m.name,key:m.name})),o.value=!1}),()=>t(R,{ref:f,size:"small",value:h.value,clearable:!0,loading:o.value,filterable:!0,tag:!0,options:n.value,onUpdateValue:i=>{h.value=i,e(i)}},null)}});return t(l,null,null)}})]}),t(p,{label:"\u6982\u8981"},{default:()=>[t(L,{type:"textarea",autosize:{minRows:2,maxRows:4},placeholder:"\u6587\u7AE0\u6982\u8981",value:a.summary,onInput:e=>void(a.summary=e)},null)]}),t(p,{label:"\u7248\u6743\u6CE8\u660E",labelAlign:"right",labelPlacement:"left"},{default:()=>[t(K,{value:a.copyright,onUpdateValue:e=>void(a.copyright=e)},null)]})]})]})});export{Se as default};
