import{H as m}from"./rounded-button-e182bc33.js";import{R as u,a as k}from"./index-66557411.js";import{D as h}from"./delete-confirm-93a73628.js";import{T as E}from"./index-bfc15a67.js";import{u as F}from"./use-table-86e8e7b0.js";import{r as d}from"./index-aa130b0b.js";import{d as v,W as x,H as C,h as a,L as w,J as l,b1 as f,O as B,ci as T,cj as A,ck as R}from"./vendor-a7b34205.js";var U=v(()=>{const{checkedRowKeys:i,data:s,fetchDataFn:r}=F(e=>async()=>{const o=(await u.api.backups.get()).data;o.sort((n,c)=>c.filename.localeCompare(n.filename)),e.value=o});x(()=>{r()}),C();const y=async()=>{const e=message.info("\u5907\u4EFD\u4E2D",{duration:1e9,closable:!0}),t=await u.api.backups.new.get({responseType:"blob",timeout:1e9});e.destroy(),message.success("\u5907\u4EFD\u5B8C\u6210"),d(t,"backup.zip")},D=async()=>{const e=document.createElement("input");e.type="file",e.style.cssText="position: absolute; opacity: 0; z-index: -9999;top: 0; left: 0",e.accept=".zip",document.body.append(e),e.click(),e.onchange=()=>{const t=e.files[0],o=new FormData;o.append("file",t),u.api.backups.rollback.post({data:o,timeout:1<<30}).then(()=>{message.success("\u6062\u590D\u6210\u529F, \u9875\u9762\u5C06\u4F1A\u91CD\u8F7D"),setTimeout(()=>{location.reload()},1e3)})}},p=async e=>{let t="";if(Array.isArray(e)?t=e.join(","):t=e,await u.api.backups.delete({params:{files:t}}),message.success("\u5220\u9664\u6210\u529F"),Array.isArray(e))e.forEach(o=>{const n=s.value.findIndex(c=>c.filename===o);n!=-1&&s.value.splice(n,1)});else{const o=s.value.findIndex(n=>n.filename===e);o!=-1&&s.value.splice(o,1)}},b=async e=>{await u.api.backups.rollback(e).patch({}),message.info("\u56DE\u6EDA\u4E2D",{closable:!0,duration:1e9})},g=async e=>{const t=message.info("\u4E0B\u8F7D\u4E2D",{duration:1e9,closable:!0}),o=await u.api.backups(e).get({responseType:"blob",timeout:1e9});t.destroy(),message.success("\u4E0B\u8F7D\u5B8C\u6210"),d(o,e+".zip")};return()=>a(k,{actionsElement:a(B,null,a(m,{icon:a(T,null),name:"\u7ACB\u5373\u5907\u4EFD",variant:"primary",onClick:y}),a(m,{icon:a(A,null),onClick:D,name:"\u4E0A\u4F20\u6062\u590D",variant:"info"}),a(h,{checkedRowKeys:i.value,onDelete:async()=>{p(i.value)},customIcon:a(R,null),customButtonTip:"\u6279\u91CF\u5220\u9664"}))},a(E,{data:s,fetchDataFn:r,checkedRowKey:"filename",nTableProps:{maxHeight:"calc(100vh - 17rem)"},onUpdateCheckedRowKeys:e=>{i.value=e},maxWidth:500,columns:[{type:"selection",options:["none","all"]},{title:"\u65E5\u671F",key:"filename"},{title:"\u5927\u5C0F",key:"size",width:200},{title:"\u64CD\u4F5C",fixed:"right",key:"filename",render(e){const t=e.filename;return a(w,{inline:!0},a(l,{text:!0,size:"tiny",type:"primary",onClick:()=>void g(t)},"\u4E0B\u8F7D"),a(f,{positiveText:"\u53D6\u6D88",negativeText:"\u56DE\u9000",onNegativeClick:()=>{b(t)}},{trigger:()=>a(l,{text:!0,size:"tiny",type:"warning"},"\u56DE\u9000"),default:()=>a("span",{class:"max-w-48"},"\u786E\u5B9A\u8981\u56DE\u9000?")}),a(f,{positiveText:"\u53D6\u6D88",negativeText:"\u5220\u9664",onNegativeClick:()=>{p(t)}},{trigger:()=>a(l,{text:!0,size:"tiny",type:"error"},"\u79FB\u9664"),default:()=>a("span",{class:"max-w-48"},"\u786E\u5B9A\u8981\u5220\u9664?")}))}}],noPagination:!0}))});export{U as default};
