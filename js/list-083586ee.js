import{d as f,X as C,al as D,w as T,o as b,a$ as B,h as t,O as w,I as m,bC as O,bD as P,b3 as R,av as x,bE as I,b1 as M,J as N,L as S}from"./vendor-a7b34205.js";import{R as i,P as L,a as H}from"./index-66557411.js";import{T as A}from"./title-link-b7884d48.js";import{D as K}from"./delete-confirm-93a73628.js";import{T as U}from"./index-bfc15a67.js";import{E as g}from"./edit-column-101e7ac3.js";import{R as k}from"./relative-time-926545d3.js";import{u as V}from"./use-table-86e8e7b0.js";import{H as q}from"./rounded-button-e182bc33.js";const Y=f({name:"NoteList",setup(){const{loading:F,checkedRowKeys:l,data:n,pager:y,sortProps:s,fetchDataFn:v}=V((o,e)=>async(r=h.query.page||1,a=20,p)=>{const c=await i.api.notes.get({params:{db_query:p,page:r,size:a,select:"title _id nid id created modified mood weather hide secret hasMemory coordinates location count",...s.sortBy?{sortBy:s.sortBy,sortOrder:s.sortOrder}:{}}});o.value=c.data,e.value=c.pagination}),d=C(),h=D(),u=v;T(()=>h.query.page,async o=>{await u(o)}),b(async()=>{await u()});const E=f({setup(){const o=B([{type:"selection",options:["none","all"]},{title:"\u5E8F\u53F7",width:64,key:"nid"},{title:"\u6807\u9898",sortOrder:!1,sorter:"default",key:"title",width:280,filter:!0,filterOptions:[{label:"\u56DE\u5FC6\u9879",value:"hasMemory"},{label:"\u9690\u85CF\u9879",value:"hide"}],render(e){const r=e.secret&&+new Date(e.secret)-+new Date>0;return t(A,{inPageTo:"/notes/edit?id="+e.id,title:e.title,externalLinkTo:"/notes/"+e.nid,id:e.id,withToken:e.hide||r},{default(){return t(w,null,e.hide||r?t(m,{color:"#34495e"},t(O,null)):null,e.hasMemory?t(m,{color:"#e74c3c"},t(P,null)):null)}})}},{title:"\u5FC3\u60C5",key:"mood",width:100,render(e,r){return t(g,{initialValue:n.value[r].mood??"",onSubmit:async a=>{await i.api.notes(e.id).put({data:{mood:a}}),d.success("\u4FEE\u6539\u6210\u529F"),n.value[r].mood=a},placeholder:"\u5FC3\u60C5"})}},{title:"\u5929\u6C14",key:"weather",width:100,render(e,r){return t(g,{initialValue:n.value[r].weather??"",onSubmit:async a=>{await i.api.notes(e.id).put({data:{weather:a}}),d.success("\u4FEE\u6539\u6210\u529F"),n.value[r].weather=a},placeholder:"\u5929\u6C14"})}},{title:"\u5730\u70B9",key:"location",width:200,render(e){const{coordinates:r,location:a}=e;return a?t(R,{class:"truncate max-w-[200px]"},{tooltip(){return t("div",{class:""},t("p",null,a),t("p",null,r?.longitude,", ",r?.latitude))},default(){return a}}):null}},{title:()=>t(m,null,t(x,null)),key:"count.read",ellipsis:!0,render(e){return e.count?.read||0}},{title:()=>t(m,null,t(I,null)),ellipsis:!0,key:"count.like",render(e){return e.count?.like||0}},{title:"\u521B\u5EFA\u4E8E",key:"created",sortOrder:"descend",sorter:"default",width:200,render(e){return t(k,{time:e.created})}},{title:"\u4FEE\u6539\u4E8E",key:"modified",sorter:"default",sortOrder:!1,width:200,render(e){return t(k,{time:e.modified})}},{title:"\u64CD\u4F5C",key:"id",width:100,fixed:"right",render(e){return t(S,null,t(M,{positiveText:"\u53D6\u6D88",negativeText:"\u5220\u9664",onNegativeClick:async()=>{await i.api.notes(e.id).delete(),d.success("\u5220\u9664\u6210\u529F"),await u(y.value.currentPage)}},{trigger:()=>t(N,{text:!0,type:"error",size:"tiny"},"\u79FB\u9664"),default:()=>t("span",{class:"max-w-48"},"\u786E\u5B9A\u8981\u5220\u9664 ",e.title," ?")}))}}]);return()=>t(U,{nTableProps:{async onUpdateFilters(e,r){const{title:a}=e;if(!a||a.length===0){await u();return}await u(1,void 0,a.reduce((p,c)=>({...p,[c]:!0}),{}))}},loading:F.value,columns:o,data:n,onFetchData:u,pager:y,onUpdateCheckedRowKeys:e=>{l.value=e},onUpdateSorter:async e=>{s.sortBy=e.sortBy,s.sortOrder=e.sortOrder}})}});return()=>t(H,null,{actions:()=>t(w,null,t(K,{checkedRowKeys:l.value,onDelete:async()=>{const o=await Promise.allSettled(l.value.map(e=>i.api.notes(e).delete()));for(const e of o)e.status==="rejected"&&d.success("\u5220\u9664\u5931\u8D25\uFF0C"+e.reason.message);l.value.length=0,u()}}),t(q,{to:"/notes/edit",icon:t(L,null)})),default:()=>t(E,null)})}});export{Y as ManageNoteListView};
