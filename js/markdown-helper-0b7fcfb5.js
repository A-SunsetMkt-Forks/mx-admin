import{a as M,R as C}from"./index-66557411.js";import{r as N}from"./index-aa130b0b.js";import{d as P,r as g,X as S,w as T,h as t,bh as B,ba as w,bc as x,J as F,Y as L,b8 as R,L as U,cl as Y,s as H,bn as I,a1 as V,be as _}from"./vendor-a7b34205.js";class O{constructor(l){this.strList=l}parse(l){const s=l,r=/-{3,}\n(.*?)-{3,}\n*(.*)$/gms.exec(s);if(!r)return{text:s};const i=r[1],E=r.pop(),b=i.split(`
`),m=[],f=[];let c=null;const v=b.reduce((e,p)=>{const u=p.trim().split(":").filter(a=>a.length),n=u.length>=2?[u[0],u.slice(1).filter(a=>a.length).join(":").trim()]:[u[0]];if(n.length===2){const[a,o]=n;["date","updated"].includes(a)?e[a]=new Date(o.trim()).toISOString():["categories:","tags:"].includes(a)?c=a==="categories:"?"cate":"tag":e[a]=o.trim()}else{const a=p.trim().replace(/^\s*-\s*/,"");if(["","tags:","categories:"].includes(a))return c=a==="categories:"?"cate":"tag",e;c==="tag"?m.push(a):f.push(a)}return e},{});return v.categories=f,v.tags=m,{meta:v,text:E}}start(){const l=this.strList,s=[];for(const r of l)s.push(this.parse(r));return s}}const W=[{value:"post",label:"\u535A\u6587"},{label:"\u65E5\u8BB0",value:"note"}];var J=P(()=>{const h=g("post"),l=g([]),s=g([]);function r(e){return new O(e).start().map((u,n)=>{const o=l.value[n].file.name.replace(/\.md$/,"");return u.meta?u.meta.slug=u.meta.slug??o:u.meta={title:o,slug:o},u.meta?.date||(u.meta.date=new Date().toISOString()),u})}const i=S();async function E(e){if(e?.preventDefault(),e?.stopPropagation(),!l.value.length)throw new ReferenceError("fileList is empty");const p=[];for await(const n of l.value){const a=await Promise.resolve(new Promise((o,y)=>{const d=n.file;if(!d){i.error("\u6587\u4EF6\u4E0D\u5B58\u5728"),y("File is empty");return}const k=d.name.split(".").pop();if(d.type&&d.type!=="text/markdown"||!["md","markdown"].includes(k)){i.error("\u53EA\u80FD\u89E3\u6790 markdown \u6587\u4EF6, \u4F46\u662F\u5F97\u5230\u4E86 "+d.type),y("File must be markdown. got type: "+d.type+", got ext: "+k);return}const A=new FileReader;A.onload=D=>{o(D.target?.result||"")},A.readAsText(d)}));console.log(a),p.push(a)}const u=r(p);i.success("\u89E3\u6790\u5B8C\u6210, \u7ED3\u679C\u67E5\u770B console \u54E6"),s.value=u.map((n,a)=>({...n,filename:l.value[a].file?.name??""})),console.log(_(s))}async function b(e){if(e.stopPropagation(),e.preventDefault(),!s.value.length)return i.error("\u8BF7\u5148\u89E3\u6790!!");await C.api.markdown.import.post({data:{type:h.value,data:s.value}}),i.success("\u4E0A\u4F20\u6210\u529F!"),l.value=[]}const m=g(!0),f=g(!1),c=g(!1);async function v(){const e=await C.api.markdown.export.get({params:{slug:c.value,yaml:m.value,show_title:f.value},responseType:"blob"});N(e,"markdown.zip")}return T(()=>l.value,e=>{e.length==0?s.value=[]:E()}),()=>t(M,null,t(L,null,"\u4ECE MarkDown \u5BFC\u5165\u6570\u636E"),t(B,{labelAlign:"right",labelPlacement:"left",labelWidth:150,class:"max-w-[300px]"},t(w,{label:"\u5BFC\u5165\u5230:"},t(R,{options:W,value:h.value,onUpdateValue:e=>void(h.value=e)})),t(w,{label:"\u51C6\u5907\u597D\u4E86\u5417."},t(U,{vertical:!0},t(Y,{multiple:!0,accept:".md,.markdown",onChange:H(e=>{l.value=e.fileList},250),onRemove:e=>{const u=e.file.name,n=s.value.findIndex(a=>a.filename===u);n!=-1&&s.value.splice(n,1)}},t(I,null,t(F,{round:!0},"\u5148\u4E0A\u4F20"),t(F,{onClick:E,disabled:!l.value.length},"\u518D\u89E3\u6790"),t(F,{onClick:b,round:!0,disabled:!s.value.length},"\u6700\u540E\u5BFC\u5165"))),t(V,{depth:2,class:"!text-sm"},"\u53EA\u80FD\u4E0A\u4F20markdown\u6587\u4EF6")))),t(L,null,"\u5BFC\u51FA\u6570\u636E\u5230 Markdown (Hexo YAML Format)"),t(B,{labelAlign:"right",labelPlacement:"left",labelWidth:180,class:"max-w-[400px]"},t(w,{label:"\u662F\u5426\u5305\u62EC yaml header"},t(x,{value:m.value,onUpdateValue:e=>void(m.value=e)})),t(w,{label:"\u662F\u5426\u5728\u7B2C\u4E00\u884C\u663E\u793A\u6587\u7AE0\u6807\u9898"},t(x,{value:f.value,onUpdateValue:e=>void(f.value=e)})),t(w,{label:"\u6839\u636E slug \u751F\u6210\u6587\u4EF6\u540D"},t(x,{value:c.value,onUpdateValue:e=>void(c.value=e)})),t("div",{class:"text-right w-full"},t(F,{type:"primary",onClick:v},"\u5BFC\u51FA"))))});export{J as default};
