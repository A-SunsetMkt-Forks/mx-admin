import{H as M}from"./rounded-button-af673ee0.js";import{d as w,i as S,v as X,x as m,R as i,u as $,w as R,cE as G,h as a,bU as Q,bX as W,z as y,a as q,N as F,bl as Z,bY as x,F as L,cx as ee,dk as ae,n as te,dl as ue,bk as re,p as ne,k as le}from"./index-5f09ba15.js";import{T as se}from"./index-0f723da9.js";import{R as ie}from"./relative-time-de220835.js";import{u as oe}from"./use-table-2b7854f0.js";import{N as de}from"./Form-e92df55a.js";import{N as v}from"./FormItem-d1d60d14.js";import{N as O}from"./Select-577ab9c6.js";import{N as ce}from"./Popconfirm-057bec62.js";import{N as ve,a as b}from"./Tabs-c84f0dbd.js";import{N as k}from"./Badge-4fdffad0.js";import{N as A}from"./Avatar-e016e7dc.js";import"./DataTable-de6e990a.js";import"./ChevronRight-5b7f4947.js";import"./Icon-32fff895.js";import"./Forward-5abdce9a.js";import"./index-7af81d95.js";import"./Tooltip-485a70b2.js";import"./Tag-22dd1dee.js";import"./Add-f587d2b5.js";import"./throttle-8cbd0d36.js";var U;(function(e){e[e.Category=0]="Category",e[e.Tag=1]="Tag"})(U||(U={}));var z;(function(e){e[e.Post=0]="Post",e[e.Note=1]="Note"})(z||(z={}));var _;(function(e){e.Page="Page",e.Post="Post",e.Note="Note"})(_||(_={}));var H;(function(e){e[e.Unread=0]="Unread",e[e.Read=1]="Read",e[e.Junk=2]="Junk"})(H||(H={}));var g;(function(e){e[e.Friend=0]="Friend",e[e.Collection=1]="Collection"})(g||(g={}));var n;(function(e){e[e.Pass=0]="Pass",e[e.Audit=1]="Audit",e[e.Outdate=2]="Outdate",e[e.Banned=3]="Banned"})(n||(n={}));var V;(function(e){e.md="md",e.html="html",e.frame="frame"})(V||(V={}));var j;(function(e){e.JSON="json",e.Function="function",e.Text="text",e.YAML="yaml"})(j||(j={}));const me={Audit:"\u5F85\u5BA1\u6838",Pass:"\u901A\u8FC7",Outdate:"\u8FC7\u65F6",Banned:"\u5C4F\u853D"};var ze=w({setup(){const e=S(),C=X(),o=m(e.query.state??n.Pass),{data:l,checkedRowKeys:pe,fetchDataFn:h,pager:E,loading:T}=oe((t,r)=>async(s=e.query.page||1,p=50)=>{const N=e.query.state??n.Pass,I=await i.api.links.get({params:{page:s,size:p,state:N|0}});t.value=I.data,r.value=I.pagination}),f=$(),B=()=>({avatar:"",name:"",type:g.Friend,url:"",id:null,description:"",state:n.Pass}),d=m(!1),u=m(B());R(()=>e.query.state,async t=>{await h()}),R(()=>e.query.page,async t=>{await h()},{immediate:!0});const c=m({}),D=async()=>{const t=await i.api.links.state.get();c.value=t};G(()=>{D()});const Y=async()=>{const t=u.value.id;if(t){const r=await i.api.links(t).put({data:ue.omit(u.value,["id","created","hide"])}),s=l.value.findIndex(p=>p.id==t);r.state!=o.value?(l.value.splice(s,1),D()):l.value[s]={...l.value[s],...re(u.value)}}else{const{data:r}=await i.api.links.post({data:{...u.value}});l.value.unshift(r)}f.success("\u64CD\u4F5C\u6210\u529F"),d.value=!1,u.value=B()},P=m(),K=async()=>{const t=f.loading("\u68C0\u67E5\u4E2D",{duration:2e5});try{const r=await i.api.links.health.get({timeout:2e5});P.value=Object.entries(r).reduce((s,[p,N])=>({...s,[p.toLowerCase()]:N}),{}),f.success("\u68C0\u67E5\u5B8C\u6210")}catch(r){console.error(r)}finally{requestAnimationFrame(()=>{t.destroy()})}};return()=>a(te,{actionsElement:a(L,null,a(M,{icon:a(ee,null),variant:"primary",onClick:()=>{u.value=B(),d.value=!0}}),a(M,{icon:a(ae,null),variant:"info",onClick:K,name:"\u68C0\u67E5\u53CB\u94FE\u53EF\u7528\u6027"}))},a(ve,{class:"min-h-[30px]",size:"medium",value:o.value,onUpdateValue:t=>{o.value=t,C.replace({name:Z.Friend,query:{state:t}})}},a(b,{name:n.Pass,tab:"\u670B\u53CB\u4EEC"}),a(b,{name:n.Audit,tab:()=>a(k,{value:c.value.audit,processing:!0},a(x,null,"\u5F85\u5BA1\u6838"))}),a(b,{name:n.Outdate,tab:()=>a(k,{value:c.value.outdate,type:"info"},a(x,null,"\u8FC7\u65F6\u7684"))}),a(b,{name:n.Banned,tab:()=>a(k,{value:c.value.banned,type:"warning"},a(x,null,"\u5C01\u7981\u7684"))})),a(se,{loading:T.value,data:l,nTableProps:{maxHeight:"calc(100vh - 22rem)"},columns:[{title:"\u5934\u50CF",key:"avatar",width:80,render(t){return a(J,{name:t.name,avatar:t.avatar})}},{title:"\u540D\u79F0",key:"name",render(t){return a("a",{target:"_blank",href:t.url,rel:"noreferrer"},t.name)}},{title:"\u63CF\u8FF0",key:"description",width:250,ellipsis:{lineClamp:2,tooltip:!0}},{title:"\u7F51\u5740",key:"url",render(t){const r=P.value?.[t.id];return a(fe,{url:t.url,errorMessage:r?.message,status:r?.status})}},{title:"\u7C7B\u578B",key:"type",width:80,render(t){return["\u670B\u53CB","\u6536\u85CF"][t.type|0]}},{title:"\u5BF9\u65B9\u90AE\u7BB1",key:"email",render(t){return a("a",{href:`mailto:${t.email}`},t.email)}},{title:"\u7ED3\u8BC6\u65F6\u95F4",key:"created",width:80,render(t){return a(ie,{time:t.created})}},{width:150,title:"\u64CD\u4F5C",fixed:"right",key:"action",render(t){return a(q,{wrap:!1},t.state==n.Audit&&a(F,{text:!0,size:"tiny",type:"success",onClick:async()=>{await i.api.links.audit(t.id).patch(),f.success("\u901A\u8FC7\u4E86\u6765\u81EA"+t.name+"\u7684\u53CB\u94FE\u9080\u8BF7");const r=l.value.findIndex(s=>s.id==t.id);l.value.splice(r,1),c.value.audit--}},"\u901A\u8FC7"),a(F,{text:!0,size:"tiny",type:"info",onClick:r=>{d.value=!0,u.value={...t}}},"\u7F16\u8F91"),a(ce,{positiveText:"\u53D6\u6D88",negativeText:"\u5220\u9664",onNegativeClick:async()=>{await i.api.links(t.id).delete(),f.success("\u5220\u9664\u6210\u529F"),await h(E.value.currentPage),t.state==n.Audit&&c.value.audit--}},{trigger:()=>a(F,{text:!0,type:"error",size:"tiny"},"\u79FB\u9664"),default:()=>a("span",{class:"max-w-48"},"\u786E\u5B9A\u8981\u5220\u9664\u53CB\u94FE ",t.name," ?")}))}}],onFetchData:h,pager:E}),a(Q,{transformOrigin:"center",show:d.value,onUpdateShow:t=>void(d.value=t)},a(W,{style:"width: 500px;max-width: 90vw",headerStyle:{textAlign:"center"},title:u.value.id?"\u7F16\u8F91: "+u.value.name:"\u65B0\u589E"},a(de,null,a(v,{label:"\u540D\u5B57",required:!0},a(y,{autofocus:!0,value:u.value.name,onInput:t=>void(u.value.name=t)})),a(v,{label:"\u5934\u50CF"},a(y,{autofocus:!0,value:u.value.avatar,onInput:t=>void(u.value.avatar=t)})),a(v,{label:"\u7F51\u5740",required:!0},a(y,{autofocus:!0,value:u.value.url,onInput:t=>void(u.value.url=t)})),a(v,{label:"\u63CF\u8FF0"},a(y,{autofocus:!0,value:u.value.description,onInput:t=>void(u.value.description=t)})),a(v,{label:"\u7C7B\u578B"},a(O,{placeholder:"\u9009\u62E9\u7C7B\u578B",options:[{label:"\u670B\u53CB",value:g.Friend},{label:"\u6536\u85CF",value:g.Collection}],value:u.value.type,onUpdateValue:t=>void(u.value.type=t|0)})),u.value.id&&a(v,{label:"\u72B6\u6001"},a(O,{placeholder:"\u9009\u62E9\u72B6\u6001",options:Object.entries(me).map(([t,r])=>({label:r,value:n[t]})),value:u.value.state,onUpdateValue:t=>void(u.value.state=t|0)}))),a("div",{class:"text-right"},a(q,{size:12,align:"center",inline:!0},a(F,{type:"success",onClick:Y,round:!0},"\u786E\u5B9A"),a(F,{onClick:()=>{d.value=!1,u.value=B()},round:!0},"\u53D6\u6D88"))))))}});const fe=w({props:{url:String,errorMessage:String,status:[String,Number]},setup(e){return()=>a("div",{class:"flex space-x-2 items-center"},a("a",{target:"_blank",href:e.url,rel:"noreferrer"},e.url),typeof e.status<"u"&&(e.errorMessage?a(ne,null,{trigger(){return a("div",{class:"h-2 w-2 bg-red-400 rounded-full"})},default(){return e.errorMessage}}):a("div",{class:"h-2 w-2 bg-green-300 rounded-full"})))}}),J=w(e=>{const C=m(!e.avatar);return le(()=>{if(e.avatar){const o=new Image;o.src=e.avatar,o.onload=l=>{C.value=!0}}}),()=>e.avatar?C.value?a(A,{src:e.avatar,round:!0}):a(A,{round:!0},e.name.charAt(0)):a(A,{round:!0},e.name.charAt(0))});J.props=["avatar","name"];export{ze as default};
