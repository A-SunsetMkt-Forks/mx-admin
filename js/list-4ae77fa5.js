import{c8 as A,bd as k,dn as F,aY as I,Q as L,f as N,U,T as B,n as E,aA as V,w as S,X as $,Z as P,a1 as D,ax as z,b0 as w,ab as y,a5 as _,y as K,a6 as q,E as x,a7 as H,a8 as R,L as G,a9 as j,R as b,p as Q,u as X,j as Y,m as Z,a,C as J,F as W,A as ee,c3 as te,c$ as ae,N as h,c6 as oe,d as se,b as g,M as ne,r as re,bo as le,dp as ie,P as ue}from"./index-94a141f8.js";import{D as ce}from"./delete-confirm-5d825efd.js";import{R as de}from"./relative-time-e7839868.js";import{u as pe}from"./use-table-713ee0f2.js";import{H as fe}from"./rounded-button-86dfc9d5.js";import{c as me,a as he,b as ge}from"./Icon-382746b8.js";import{t as ve,b as ye}from"./Select-bade2b3f.js";import{N as be,a as Pe}from"./ListItem-b787ae95.js";import{N as Ne}from"./Pagination-6cea0380.js";import{N as Me}from"./ButtonGroup-62a671f8.js";import{N as T}from"./Avatar-0a235adf.js";import"./Tag-9da39b6c.js";import"./Forward-28020832.js";const we=A({name:"Popselect",common:k,peers:{Popover:F,InternalSelectMenu:I}});var je=we;const C=L("n-popselect"),M={multiple:Boolean,value:{type:[String,Number,Array],default:null},cancelable:Boolean,options:{type:Array,default:()=>[]},size:{type:String,default:"medium"},scrollable:Boolean,"onUpdate:value":[Function,Array],onUpdateValue:[Function,Array],onMouseenter:Function,onMouseleave:Function,renderLabel:Function,onChange:[Function,Array]},O=D(M);var Te=N({name:"PopselectPanel",props:M,setup(o){const s=U(C),{mergedClsPrefixRef:i}=B(o),l=E(()=>V(o.options,ve));function u(t,e){const{onUpdateValue:n,"onUpdate:value":p,onChange:f}=o;n&&y(n,t,e),p&&y(p,t,e),f&&y(f,t,e)}function c(t){r(t.key)}function d(t){z(t,"action")||t.preventDefault()}function r(t){const{value:{getNode:e}}=l;if(o.multiple)if(Array.isArray(o.value)){const n=[],p=[];let f=!0;o.value.forEach(m=>{if(m===t){f=!1;return}const v=e(m);v&&(n.push(v.key),p.push(v.rawNode))}),f&&(n.push(t),p.push(e(t).rawNode)),u(n,p)}else{const n=e(t);n&&u([t],[n.rawNode])}else if(o.value===t&&o.cancelable)u(null,null);else{const n=e(t);n&&u(t,n.rawNode),s.setShow(!1)}w(()=>{s.syncPosition()})}return S($(o,"options"),()=>{w(()=>{s.syncPosition()})}),{mergedTheme:s.mergedThemeRef,mergedClsPrefix:i,treeMate:l,handleToggle:c,handleMenuMousedown:d}},render(){return P(ye,{clsPrefix:this.mergedClsPrefix,focusable:!0,theme:this.mergedTheme.peers.InternalSelectMenu,themeOverrides:this.mergedTheme.peerOverrides.InternalSelectMenu,multiple:this.multiple,treeMate:this.treeMate,size:this.size,value:this.value,virtualScroll:!1,scrollable:this.scrollable,renderLabel:this.renderLabel,onToggle:this.handleToggle,onMouseenter:this.onMouseenter,onMouseleave:this.onMouseenter,onMousedown:this.handleMenuMousedown},{action:()=>{var o,s;return((s=(o=this.$slots).action)===null||s===void 0?void 0:s.call(o))||[]},empty:()=>{var o,s;return((s=(o=this.$slots).empty)===null||s===void 0?void 0:s.call(o))||[]}})}});const Oe=Object.assign(Object.assign(Object.assign(Object.assign({},_.props),R(j,["showArrow","arrow"])),{placement:Object.assign(Object.assign({},j.placement),{default:"bottom"}),trigger:{type:String,default:"hover"}}),M);var Se=N({name:"Popselect",props:Oe,__popover__:!0,setup(o){const s=_("Popselect","-popselect",void 0,je,o),i=K(null);function l(){var d;(d=i.value)===null||d===void 0||d.syncPosition()}function u(d){var r;(r=i.value)===null||r===void 0||r.setShow(d)}return q(C,{mergedThemeRef:s,syncPosition:l,setShow:u}),Object.assign(Object.assign({},{syncPosition:l,setShow:u}),{popoverInstRef:i,mergedTheme:s})},render(){const{mergedTheme:o}=this,s={theme:o.peers.Popover,themeOverrides:o.peerOverrides.Popover,builtinThemeOverrides:{padding:"0"},ref:"popoverInstRef",internalRenderBody:(i,l,u,c,d)=>P(Te,Object.assign({},x(this.$attrs,{class:i,style:u}),H(this.$props,O),{ref:me(l),onMouseenter:c,onMouseleave:d}),{action:()=>{var r,t;return(t=(r=this.$slots).action)===null||t===void 0?void 0:t.call(r)},empty:()=>{var r,t;return(t=(r=this.$slots).empty)===null||t===void 0?void 0:t.call(r)}})};return P(G,Object.assign({},R(this.$props,O),s),{trigger:()=>{var i,l;return(l=(i=this.$slots).default)===null||l===void 0?void 0:l.call(i)}})}});function _e(o){return typeof o=="function"||Object.prototype.toString.call(o)==="[object Object]"&&!ue(o)}const De=N({setup(){const{data:o,pager:s,sortProps:i,fetchDataFn:l,loading:u}=pe((e,n)=>async(p=r.query.page||1,f=30)=>{const m=await b.api.projects.get({params:{page:p,size:f}});e.value=m.data,n.value=m.pagination}),c=Q(new Set),d=X(),r=Y(),t=l;return S(()=>r.query.page,async e=>{await t(e)}),Z(async()=>{await t()}),()=>a(J,null,{actions:()=>a(W,null,[a(ce,{checkedRowKeys:c,onDelete:async()=>{await Promise.all(Array.from(c.values()).map(e=>b.api.projects(e).delete())),c.clear(),t()}},null),a(fe,{to:"/projects/edit",icon:a(ee,null,null)},null)]),default:()=>a(te,{show:u.value},{default:()=>[a(be,{bordered:!1,class:"min-h-[300px]"},{footer(){return a("div",{class:"flex justify-end"},[a(Ne,{itemCount:s.value.total,pageCount:s.value.totalPage,page:s.value.currentPage,pageSize:s.value.size,onUpdatePage:e=>{t(e)}},null)])},default(){return o.value.map(e=>a(Pe,{key:e.id},{prefix(){return a(he,{class:"mt-4",checked:c.has(e.id),onUpdateChecked:n=>{n?c.add(e.id):c.delete(e.id)}},null)},default(){return a(ae,{description:e.description},{header(){return a("div",null,[a(h,x({ghost:!0,type:"primary",text:!0,class:"!font-medium"},e.projectUrl?{tag:"a",href:e.projectUrl,target:"_blank"}:{}),{default:()=>[e.name]})])},footer(){return a(oe,null,{default:()=>[a(se,{class:"pl-[3.6rem] text-[var(--clear-color-pressed)] text-sm"},{default:()=>[a("span",null,[g("\u521B\u5EFA\u4E8E "),ne(e.created)]),e.modified&&a("span",null,[g("\u66F4\u65B0\u4E8E")," ",a(de,{time:e.modified},null)])]})]})},"header-extra":function(){return a(Me,null,{default:()=>[a(h,{onClick:()=>{re.push({name:le.EditProject,query:{id:e.id}})}},{default:()=>[g("\u7F16\u8F91")]}),a(Se,{class:"!p-0",options:[{value:"del",label:"",render(){return a(h,{type:"error",bordered:!1,onClick:async()=>{await b.api.projects(e.id).delete(),d.success("\u5220\u9664\u6210\u529F"),await t(s.value.currentPage)}},{default:()=>[g("\u5220\u9664")]})}}]},{default:()=>[a(h,{class:"!px-2"},{default:()=>[a(ge,null,{default:()=>[a(ie,null,null)]})]})]})]})},avatar(){let n;return e.avatar?a(T,{class:"align-center",circle:!0,src:e.avatar,size:"large"},null):a(T,{circle:!0,size:"large",class:"align-center"},_e(n=e.name[0].toUpperCase())?n:{default:()=>[n]})}})}}))}})]})})}});export{De as default};
