import{bF as L,d as N,X as V,r as h,h as a,J as y,I as T,bG as q,w as U,s as z,bo as H,U as j,O as D,bh as G,ba as g,bH as J,L as F,bI as Y,be as $,by as Z,al as K,t as I,W as X,a$ as Q,o as ee,u as te,b8 as M,bn as ae,bc as P,G as ue,bJ as oe,bK as S,bb as le,T as ne,bd as re,bf as se}from"./vendor-a7b34205.js";import{H as ie}from"./rounded-button-e182bc33.js";import{T as ce,M as de,P as pe}from"./parse-content-b2d97682.js";import{V as fe,b as ve,I as R,u as me,E as ge}from"./toggle-e7c686f7.js";import{R as E,f as k,W as be,a as ye,d as he}from"./index-66557411.js";import{u as we}from"./use-parse-payload-ee448945.js";import"./js-yaml-fae8e8ce.js";import"./use-react-1ab208ae.js";import"./use-save-confirm-3e742716.js";var x={exports:{}};(function(s,o){Object.defineProperty(o,"__esModule",{value:!0}),o.default=c;function u(n){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?u=function(l){return typeof l}:u=function(l){return l&&typeof Symbol=="function"&&l.constructor===Symbol&&l!==Symbol.prototype?"symbol":typeof l},u(n)}function c(n){var e=typeof n=="string"||n instanceof String;if(!e){var l=u(n);throw n===null?l="null":l==="object"&&(l=n.constructor.name),new TypeError("Expected a string but received a ".concat(l))}}s.exports=o.default,s.exports.default=o.default})(x,x.exports);var O={exports:{}};(function(s,o){Object.defineProperty(o,"__esModule",{value:!0}),o.default=r;var u=c(x.exports);function c(d){return d&&d.__esModule?d:{default:d}}var n=/^([\+-]?\d{4}(?!\d{2}\b))((-?)((0[1-9]|1[0-2])(\3([12]\d|0[1-9]|3[01]))?|W([0-4]\d|5[0-3])(-?[1-7])?|(00[1-9]|0[1-9]\d|[12]\d{2}|3([0-5]\d|6[1-6])))([T\s]((([01]\d|2[0-3])((:?)[0-5]\d)?|24:?00)([\.,]\d+(?!:))?)?(\17[0-5]\d([\.,]\d+)?)?([zZ]|([\+-])([01]\d|2[0-3]):?([0-5]\d)?)?)?)?$/,e=/^([\+-]?\d{4}(?!\d{2}\b))((-?)((0[1-9]|1[0-2])(\3([12]\d|0[1-9]|3[01]))?|W([0-4]\d|5[0-3])(-?[1-7])?|(00[1-9]|0[1-9]\d|[12]\d{2}|3([0-5]\d|6[1-6])))([T]((([01]\d|2[0-3])((:?)[0-5]\d)?|24:?00)([\.,]\d+(?!:))?)?(\17[0-5]\d([\.,]\d+)?)?([zZ]|([\+-])([01]\d|2[0-3]):?([0-5]\d)?)?)?)?$/,l=function(p){var i=p.match(/^(\d{4})-?(\d{3})([ T]{1}\.*|$)/);if(i){var v=Number(i[1]),b=Number(i[2]);return v%4===0&&v%100!==0||v%400===0?b<=366:b<=365}var w=p.match(/(\d{4})-?(\d{0,2})-?(\d*)/).map(Number),t=w[1],f=w[2],m=w[3],C=f&&"0".concat(f).slice(-2),W=m&&"0".concat(m).slice(-2),A=new Date("".concat(t,"-").concat(C||"01","-").concat(W||"01"));return f&&m?A.getUTCFullYear()===t&&A.getUTCMonth()+1===f&&A.getUTCDate()===m:!0};function r(d){var p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};(0,u.default)(d);var i=p.strictSeparator?e.test(d):n.test(d);return i&&p.strict?l(d):i}s.exports=o.default,s.exports.default=o.default})(O,O.exports);var Ee=L(O.exports),Ce="isIso8601";function Se(s,o){return typeof s=="string"&&Ee(s,o)}function Fe(s,o){return fe({name:Ce,constraints:[s],validator:{validate:function(u,c){return Se(u,c.constraints[0])},defaultMessage:ve(function(u){return u+"$property must be a valid ISO 8601 date string"},o)}},o)}const De=N({props:{onChange:{type:Function,required:!0}},setup(s){const o=V(),u=h(!1),c=async()=>{const n=()=>new Promise((e,l)=>{navigator.geolocation.getCurrentPosition(r=>{u.value=!0,e(r),u.value=!1},r=>{u.value=!1,l(r)})});if(navigator.geolocation)try{const e=await n(),{coords:{latitude:l,longitude:r}}=e,d=[r,l],p=await E.api.tools.geocode.location.get({params:{longitude:r,latitude:l}});s.onChange(p.regeocode,d)}catch{o.error("\u5B9A\u4F4D\u6743\u9650\u672A\u6253\u5F00")}else o.error("\u6D4F\u89C8\u5668\u4E0D\u652F\u6301\u5B9A\u4F4D")};return()=>a(y,{ghost:!0,round:!0,type:"primary",onClick:c,loading:u.value},{icon(){return a(T,null,a(q,null))},default(){return"\u5B9A\u4F4D"}})}}),Be=N({props:{placeholder:{type:String,default:""},onChange:{type:Function,required:!0}},setup(s){const o=h(!1),u=h(!1),c=h(""),n=async r=>await E.api.tools.geocode.search.get({params:{keywords:r}}),e=h([]);U(()=>c.value,z(async r=>{o.value=!0;const d=await n(r);e.value=[],d.pois.forEach(p=>{const i=p.cityname+p.adname+p.address+p.name,[v,b]=p.location.split(",").map(Number);e.value.push({key:p.cityname,label:i,value:JSON.stringify([i,{latitude:b,longitude:v}])})}),o.value=!1},400,{trailing:!0,leading:!0}));let l;return()=>a(D,null,a(y,{ghost:!0,round:!0,onClick:()=>{u.value=!0}},{icon(){return a(T,null,a(Y,null))},default(){return"\u81EA\u5B9A\u4E49"}}),a(H,{transformOrigin:"center",show:u.value,onUpdateShow:r=>void(u.value=r)},a(j,{class:"modal-card sm",bordered:!1,closable:!0,onClose:()=>{u.value=!1},title:"\u641C\u7D22\u5173\u952E\u5B57\u67E5\u627E\u5730\u70B9"},{default:()=>a(D,null,a(G,{labelPlacement:"top"},a(g,{label:"\u641C\u7D22\u5730\u70B9"},a(J,{placeholder:s.placeholder||"",onSelect:r=>{l=r},options:e.value,loading:o.value,onUpdateValue:r=>{c.value=r},value:c.value}))),a(F,{justify:"end"},a(y,{round:!0,type:"primary",onClick:()=>{const r=JSON.parse(l);s.onChange.apply(this,r),u.value=!1},disabled:o.value},"\u786E\u5B9A")))})))}}),Ae=["\u5F00\u5FC3","\u4F24\u5FC3","\u51B3\u5FC3","\u575A\u5B9A","\u75DB\u6068","\u751F\u6C14","\u60B2\u54C0","\u75DB\u82E6","\u53EF\u6015","\u4E0D\u5FEB","\u53EF\u6076","\u62C5\u5FC3","\u7EDD\u671B","\u7126\u8651","\u6FC0\u52A8"],Ie=["\u6674","\u591A\u4E91","\u96E8","\u9634","\u96EA","\u96F7\u96E8"];var Pe=Object.defineProperty,xe=Object.getOwnPropertyDescriptor,_=(s,o,u,c)=>{for(var n=c>1?void 0:c?xe(o,u):o,e=s.length-1,l;e>=0;e--)(l=s[e])&&(n=(c?l(o,u,n):l(n))||n);return c&&n&&Pe(o,u,n),n};class B{savedTime;text;title}_([Fe()],B.prototype,"savedTime",2);_([R()],B.prototype,"text",2);_([R()],B.prototype,"title",2);const Oe=(s,o,u)=>{let c;const{storage:n,reset:e,clear:l}=me(B,"auto-save-"+s,!1);let r=u();const d=()=>{const{text:i,title:v}=u();!i&&!v||r.text==i&&r.title==v||(r={text:i,title:v},Object.assign(n,{savedTime:new Date().toISOString(),text:i,title:v}),console.log("saved data: ",n))};function p(){clearInterval(c)}return{reset:e,getPrevSaved(){return{...$(n)}},save:d,track(){p(),d(),c=setInterval(d,o)},disposer:p,clearSaved:l}},Ne=(s,o)=>{const{disposer:u,clearSaved:c,getPrevSaved:n,reset:e,save:l,track:r}=o,d=window.dialog;return(async()=>{const i=n();console.log("prev saved: ",i),(i.text||i.title)&&(i.text!==s.text||i.title!==s.title)&&requestAnimationFrame(()=>{d.info({title:"\u53D1\u73B0\u6709\u672A\u4FDD\u5B58\u7684\u5185\u5BB9, \u662F\u5426\u8FD8\u539F?",negativeText:"\u6E05\u695A",positiveText:"\u55EF",onNegativeClick(){c()},onPositiveClick(){Object.assign(s,{text:i.text,title:i.title})}})})})(),r(),Z(()=>{l(),u()}),o},Le=N(()=>{const s=K(),o=h("\u5199\u70B9\u4EC0\u4E48\u5462"),u=I(()=>s.query.id);X(()=>{if(u.value)return;const t=new Date;o.value=`\u8BB0\u5F55 ${t.getFullYear()} \u5E74\u7B2C ${k(t)} \u5929`});const c=()=>({text:"",title:"",hide:!1,hasMemory:!1,mood:"",music:[],password:null,secret:null,weather:"",location:"",coordinates:null,allowComment:!0,id:void 0,images:[]}),n=t=>we(e)(t),e=Q(c()),l=h(),r=I(()=>!!(u.value&&typeof e.id>"u")),d=U(()=>r.value,t=>{if(t)return;const f=Oe("note-"+(u.value||"new"),3e3,()=>({text:e.text,title:e.title}));Ne(e,f),requestAnimationFrame(()=>{d()})},{immediate:!0});ee(async()=>{const t=u.value;if(t&&typeof t=="string"){const m=(await E.api.notes(t).get({params:{single:!0}})).data;l.value=m.nid,m.secret=m.secret?new Date(m.secret):null;const C=new Date(m.created);o.value=`\u8BB0\u5F55 ${C.getFullYear()} \u5E74\u7B2C ${k(C)} \u5929`,n(m)}});const p=h(!1),i=V(),v=te(),b=I(()=>typeof e.password=="string"),w=async()=>{const t=()=>({...$(e),title:e.title&&e.title.trim()?e.title.trim():o.value,password:e.password&&e.password.length>0?e.password:null,secret:e.secret?(()=>{const f=new Date(e.secret);return+f-+new Date<=0?null:f})():null,music:e.music});if(u.value){if(!se(u.value))return;const f=u.value;await E.api.notes(f).put({data:t()}),i.success("\u4FEE\u6539\u6210\u529F")}else await E.api.notes.post({data:t()}),i.success("\u53D1\u5E03\u6210\u529F");v.push({name:he.ViewNote,hash:"|publish"})};return()=>a(ye,{title:"\u6811\u6D1E",actionsElement:a(D,null,a(pe,{data:e,onHandleYamlParsedMeta:t=>{e.title=t.title??e.title,e.mood=t.mood??e.mood,e.weather=t.weather??e.weather}}),a(ie,{icon:a(ne,null),onClick:w})),footerButtonElement:a(D,null,a("button",{onClick:()=>{p.value=!0}},a(T,null,a(re,null))))},a(de,{class:"mt-3 relative z-10",label:o.value,value:e.title,onChange:t=>{e.title=t}}),a("div",{class:"text-gray-500 py-3"},a("label",null,`${be}/notes/${l.value??""}`)),a(ge,{loading:r.value,onChange:t=>{e.text=t},text:e.text}),a(ce,{data:e,show:p.value,onUpdateShow:t=>{p.value=t}},a(g,{label:"\u5FC3\u60C5",required:!0},a(M,{value:e.mood,filterable:!0,tag:!0,options:Ae.map(t=>({label:t,value:t})),onUpdateValue:t=>void(e.mood=t)})),a(g,{label:"\u5929\u6C14",required:!0},a(M,{value:e.weather,filterable:!0,tag:!0,options:Ie.map(t=>({label:t,value:t})),onUpdateValue:t=>void(e.weather=t)})),a(g,{label:"\u83B7\u53D6\u5F53\u524D\u5730\u5740",labelPlacement:"left"},a(F,{vertical:!0},a(ae,null,a(De,{onChange:(t,f)=>{e.location=t.formattedAddress,e.coordinates={longitude:f[0],latitude:f[1]}}}),a(Be,{placeholder:e.location,onChange:(t,f)=>{e.location=t,e.coordinates=f}}),a(y,{round:!0,disabled:!e.location,onClick:()=>{e.location="",e.coordinates=null}},"\u6E05\u695A")),a(F,{vertical:!0},a("span",null,e.location),e.coordinates&&a("span",null,e.coordinates.longitude,", ",e.coordinates.latitude)))),a(g,{label:"\u8BBE\u5B9A\u5BC6\u7801?",labelAlign:"right",labelPlacement:"left"},a(P,{value:b.value,onUpdateValue:t=>{t?e.password="":e.password=null}})),b.value&&a(g,{label:"\u8F93\u5165\u5BC6\u7801"},a(ue,{disabled:!b.value,placeholder:"",type:"password",value:e.password,inputProps:{name:"note-password",autocapitalize:"off",autocomplete:"new-password"},onInput:t=>void(e.password=t)})),a(g,{label:"\u591A\u4E45\u4E4B\u540E\u516C\u5F00",labelWidth:"50%",labelAlign:"right",labelPlacement:"left"},a(oe,{type:"datetime",isDateDisabled:t=>+new Date(t)-+new Date<0,placeholder:"\u9009\u62E9\u65F6\u95F4",value:e.secret,onUpdateValue:t=>{e.secret=t?new Date(t):null}},{footer:()=>{const t=new Date;return a(F,null,a(y,{round:!0,type:"default",size:"small",onClick:()=>{e.secret=S(t,{days:1})}},"\u4E00\u5929\u540E"),a(y,{round:!0,type:"default",size:"small",onClick:()=>{e.secret=S(t,{weeks:1})}},"\u4E00\u5468\u540E"),a(y,{round:!0,type:"default",size:"small",onClick:()=>{e.secret=S(t,{days:14})}},"\u534A\u4E2A\u6708\u540E"),a(y,{round:!0,type:"default",size:"small",onClick:()=>{e.secret=S(t,{months:1})}},"\u4E00\u4E2A\u6708\u540E"))}})),a(g,{label:"\u9690\u85CF",labelWidth:"50%",labelAlign:"right",labelPlacement:"left"},a(P,{value:e.hide,onUpdateValue:t=>void(e.hide=t)})),a(g,{label:"\u6807\u8BB0\u4E3A\u5B58\u5728\u56DE\u5FC6\u9879",labelAlign:"right",labelPlacement:"left",labelWidth:"50%"},a(P,{value:e.hasMemory,onUpdateValue:t=>void(e.hasMemory=t)})),a(g,{label:"\u97F3\u4E50 (\u7F51\u6613\u4E91 ID)"},a(le,{value:e.music.map(t=>t.id),onUpdateValue:t=>{e.music=t.map(f=>({type:"netease",id:f}))}}))))});export{Le as default};
