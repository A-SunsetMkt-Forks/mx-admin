import{H as M}from"./rounded-button-e182bc33.js";import{R as i,d as K,P as W,m as X,a as Y}from"./index-66557411.js";import{T as $}from"./index-bfc15a67.js";import{R as Q}from"./relative-time-926545d3.js";import{u as Z}from"./use-table-86e8e7b0.js";import{d as w,al as L,u as ee,r as m,X as ae,w as O,W as ue,h as a,bo as te,U as ne,bh as re,ba as v,G as b,b8 as R,L as q,J as g,b1 as le,bO as se,bP as y,bz as N,a1 as A,O as ie,c2 as oe,be as de,F as ce,o as ve,bT as k}from"./vendor-a7b34205.js";var U;(function(e){e[e.Category=0]="Category",e[e.Tag=1]="Tag"})(U||(U={}));var z;(function(e){e[e.Post=0]="Post",e[e.Note=1]="Note"})(z||(z={}));var _;(function(e){e.Page="Page",e.Post="Post",e.Note="Note"})(_||(_={}));var H;(function(e){e[e.Unread=0]="Unread",e[e.Read=1]="Read",e[e.Junk=2]="Junk"})(H||(H={}));var p;(function(e){e[e.Friend=0]="Friend",e[e.Collection=1]="Collection"})(p||(p={}));var r;(function(e){e[e.Pass=0]="Pass",e[e.Audit=1]="Audit",e[e.Outdate=2]="Outdate",e[e.Banned=3]="Banned"})(r||(r={}));var J;(function(e){e.md="md",e.html="html",e.frame="frame"})(J||(J={}));var T;(function(e){e.JSON="json",e.Text="text",e.YAML="yaml"})(T||(T={}));const me={Audit:"\u5F85\u5BA1\u6838",Pass:"\u901A\u8FC7",Outdate:"\u8FC7\u65F6",Banned:"\u5C4F\u853D"};var ye=w({setup(){const e=L(),h=ee(),o=m(e.query.state??r.Pass),{data:l,checkedRowKeys:Fe,fetchDataFn:C,pager:E,loading:j}=Z((u,n)=>async(s=e.query.page||1,F=50)=>{const x=e.query.state??r.Pass,I=await i.api.links.get({params:{page:s,size:F,state:x|0}});u.value=I.data,n.value=I.pagination}),f=ae(),B=()=>({avatar:"",name:"",type:p.Friend,url:"",id:null,description:"",state:r.Pass}),d=m(!1),t=m(B());O(()=>e.query.state,async u=>{await C()}),O(()=>e.query.page,async u=>{await C()},{immediate:!0});const c=m({}),P=async()=>{const u=await i.api.links.state.get();c.value=u};ue(()=>{P()});const S=async()=>{const u=t.value.id;if(u){const n=await i.api.links(u).put({data:oe.omit(t.value,["id","created","hide"])}),s=l.value.findIndex(F=>F.id==u);n.state!=o.value?(l.value.splice(s,1),P()):l.value[s]={...l.value[s],...de(t.value)}}else{const{data:n}=await i.api.links.post({data:{...t.value}});l.value.unshift(n)}f.success("\u64CD\u4F5C\u6210\u529F"),d.value=!1,t.value=B()},D=m(),G=async()=>{const u=f.loading("\u68C0\u67E5\u4E2D",{duration:2e5});try{const n=await i.api.links.health.get({timeout:2e5});D.value=Object.entries(n).reduce((s,[F,x])=>({...s,[F.toLowerCase()]:x}),{}),f.success("\u68C0\u67E5\u5B8C\u6210")}catch(n){console.error(n)}finally{requestAnimationFrame(()=>{u.destroy()})}};return()=>a(Y,{actionsElement:a(ie,null,a(M,{icon:a(W,null),variant:"primary",onClick:()=>{t.value=B(),d.value=!0}}),a(M,{icon:a(X,null),variant:"info",onClick:G,name:"\u68C0\u67E5\u53CB\u94FE\u53EF\u7528\u6027"}))},a(se,{class:"min-h-[30px]",size:"medium",value:o.value,onUpdateValue:u=>{o.value=u,h.replace({name:K.Friend,query:{state:u}})}},a(y,{name:r.Pass,tab:"\u670B\u53CB\u4EEC"}),a(y,{name:r.Audit,tab:()=>a(N,{value:c.value.audit,processing:!0},a(A,null,"\u5F85\u5BA1\u6838"))}),a(y,{name:r.Outdate,tab:()=>a(N,{value:c.value.outdate,type:"info"},a(A,null,"\u8FC7\u65F6\u7684"))}),a(y,{name:r.Banned,tab:()=>a(N,{value:c.value.banned,type:"warning"},a(A,null,"\u5C01\u7981\u7684"))})),a($,{loading:j.value,data:l,nTableProps:{maxHeight:"calc(100vh - 22rem)"},columns:[{title:"\u5934\u50CF",key:"avatar",width:80,render(u){return a(V,{name:u.name,avatar:u.avatar})}},{title:"\u540D\u79F0",key:"name",render(u){return a("a",{target:"_blank",href:u.url,rel:"noreferrer"},u.name)}},{title:"\u63CF\u8FF0",key:"description",width:250,ellipsis:{lineClamp:2,tooltip:!0}},{title:"\u7F51\u5740",key:"url",render(u){const n=D.value?.[u.id];return a(fe,{url:u.url,errorMessage:n?.message,status:n?.status})}},{title:"\u7C7B\u578B",key:"type",width:80,render(u){return["\u670B\u53CB","\u6536\u85CF"][u.type|0]}},{title:"\u5BF9\u65B9\u90AE\u7BB1",key:"email",render(u){return a("a",{href:`mailto:${u.email}`},u.email)}},{title:"\u7ED3\u8BC6\u65F6\u95F4",key:"created",width:80,render(u){return a(Q,{time:u.created})}},{width:150,title:"\u64CD\u4F5C",fixed:"right",key:"action",render(u){return a(q,{wrap:!1},u.state==r.Audit&&a(g,{text:!0,size:"tiny",type:"success",onClick:async()=>{await i.api.links.audit(u.id).patch(),f.success("\u901A\u8FC7\u4E86\u6765\u81EA"+u.name+"\u7684\u53CB\u94FE\u9080\u8BF7");const n=l.value.findIndex(s=>s.id==u.id);l.value.splice(n,1),c.value.audit--}},"\u901A\u8FC7"),a(g,{text:!0,size:"tiny",type:"info",onClick:n=>{d.value=!0,t.value={...u}}},"\u7F16\u8F91"),a(le,{positiveText:"\u53D6\u6D88",negativeText:"\u5220\u9664",onNegativeClick:async()=>{await i.api.links(u.id).delete(),f.success("\u5220\u9664\u6210\u529F"),await C(E.value.currentPage),u.state==r.Audit&&c.value.audit--}},{trigger:()=>a(g,{text:!0,type:"error",size:"tiny"},"\u79FB\u9664"),default:()=>a("span",{class:"max-w-48"},"\u786E\u5B9A\u8981\u5220\u9664\u53CB\u94FE ",u.name," ?")}))}}],onFetchData:C,pager:E}),a(te,{transformOrigin:"center",show:d.value,onUpdateShow:u=>void(d.value=u)},a(ne,{style:"width: 500px;max-width: 90vw",headerStyle:{textAlign:"center"},title:t.value.id?"\u7F16\u8F91: "+t.value.name:"\u65B0\u589E"},a(re,null,a(v,{label:"\u540D\u5B57",required:!0},a(b,{autofocus:!0,value:t.value.name,onInput:u=>void(t.value.name=u)})),a(v,{label:"\u5934\u50CF"},a(b,{autofocus:!0,value:t.value.avatar,onInput:u=>void(t.value.avatar=u)})),a(v,{label:"\u7F51\u5740",required:!0},a(b,{autofocus:!0,value:t.value.url,onInput:u=>void(t.value.url=u)})),a(v,{label:"\u63CF\u8FF0"},a(b,{autofocus:!0,value:t.value.description,onInput:u=>void(t.value.description=u)})),a(v,{label:"\u7C7B\u578B"},a(R,{placeholder:"\u9009\u62E9\u7C7B\u578B",options:[{label:"\u670B\u53CB",value:p.Friend},{label:"\u6536\u85CF",value:p.Collection}],value:t.value.type,onUpdateValue:u=>void(t.value.type=u|0)})),t.value.id&&a(v,{label:"\u72B6\u6001"},a(R,{placeholder:"\u9009\u62E9\u72B6\u6001",options:Object.entries(me).map(([u,n])=>({label:n,value:r[u]})),value:t.value.state,onUpdateValue:u=>void(t.value.state=u|0)}))),a("div",{class:"text-right"},a(q,{size:12,align:"center",inline:!0},a(g,{type:"success",onClick:S,round:!0},"\u786E\u5B9A"),a(g,{onClick:()=>{d.value=!1,t.value=B()},round:!0},"\u53D6\u6D88"))))))}});const fe=w({props:{url:String,errorMessage:String,status:[String,Number]},setup(e){return()=>a("div",{class:"flex space-x-2 items-center"},a("a",{target:"_blank",href:e.url,rel:"noreferrer"},e.url),typeof e.status<"u"&&(e.errorMessage?a(ce,null,{trigger(){return a("div",{class:"h-2 w-2 bg-red-400 rounded-full"})},default(){return e.errorMessage}}):a("div",{class:"h-2 w-2 bg-green-300 rounded-full"})))}}),V=w(e=>{const h=m(!e.avatar);return ve(()=>{if(e.avatar){const o=new Image;o.src=e.avatar,o.onload=l=>{h.value=!0}}}),()=>e.avatar?h.value?a(k,{src:e.avatar,round:!0}):a(k,{round:!0},e.name.charAt(0)):a(k,{round:!0},e.name.charAt(0))});V.props=["avatar","name"];export{ye as default};
