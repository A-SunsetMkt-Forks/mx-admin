import{f,y as r,m as p,a as e,F as b,bY as N,b$ as k,c3 as y,b as c,N as v,R as m,e as h,K as T,j as C,n as L,x as S,C as R}from"./index-ac59d87d.js";import{X as w}from"./index-828baff9.js";import{N as U,a as M}from"./ListItem-fae763cd.js";import{N as D}from"./Select-75da8fa3.js";import{u as F}from"./use-react-e9590db4.js";import{socket as i}from"./index-abb4ba03.js";import{E as g}from"./types-4fa065e6.js";import{N as V,a as x}from"./Tabs-3dd62629.js";import"./Tag-d2284e4b.js";import"./index-2df64eb0.js";import"./Add-7b6a6fe6.js";import"./throttle-d8c4d751.js";const B=f({setup(){const s=r([]),l=r(!1),o=async()=>{l.value=!0;const{data:t}=await m.api.health.log.list(a.value).get();s.value=t,l.value=!1};p(()=>{o()});const u=r(""),n=r(!1),a=r("native");return()=>e(b,null,[e(N,{transformOrigin:"center",show:n.value,onUpdateShow:t=>void(n.value=t)},{default:()=>[e(k,{title:"\u67E5\u770B\u65E5\u5FD7",class:"modal-card !w-[100rem] !bg-dark-400 !text-white !all:text-white ",bordered:!1,closable:!0,onClose:()=>{n.value=!1}},{default:()=>[e(E,{data:u.value},null)]})]}),e(y,{show:l.value},{default:()=>[e(U,{class:"min-h-[300px]"},{header(){return e(D,{class:"ml-auto w-32",value:a.value,onUpdateValue:t=>{a.value=t,o()},options:[{label:"PM2",value:"pm2"},{label:"\u7CFB\u7EDF\u8BB0\u5F55",value:"native"}]},null)},default(){return s.value.map(t=>e(M,{key:t.filename},{default(){return e("div",{class:"flex flex-col"},[e("span",null,[t.filename]),e("span",{class:"text-gray-400 dark:text-gray-600 text-sm grid grid-cols-[5rem,auto]"},[e("span",null,[t.size]),e("span",null,[c("\u7C7B\u578B\uFF1A"),t.type])])])},suffix(){return e("div",{class:"flex space-x-2"},[e(v,{ghost:!0,type:"success",onClick:()=>{m.api.health.log(a.value).get({params:{filename:t.filename}}).then(d=>{u.value=d,n.value=!0})}},{default:()=>[c("\u67E5\u770B")]}),e(v,{ghost:!0,type:"error",onClick:()=>{m.api.health.log(a.value).delete({params:{filename:t.filename}}).then(()=>{s.value.splice(s.value.findIndex(d=>d.filename===t.filename),1)})}},{default:()=>[c("\u5220\u9664")]})])}}))}})]})])}}),E=f({props:{data:{type:String,default:""}},setup(s){const l=r(!0);return p(()=>{setTimeout(()=>{l.value=!1},1e3)}),()=>e("div",{class:"h-[600px] max-h-[70vh] overflow-auto relative"},[l.value?e("div",{class:"w-full flex items-center justify-center h-full"},[e(y,{show:!0,strokeWidth:14},null)]):e(w,{class:"h-full w-full max-h-full",onReady:o=>{o.write(s.data)}},null)])}}),q=f({setup(){const s=(a=!0)=>{i.socket.emit("log",{prevLog:a})};let l;const o=[],u=a=>{l?(o.length>0&&n(l),l.write(a)):o.push(a)},n=a=>{for(;o.length;){const t=o.shift();a.write(t)}};return p(()=>{s(),h.on(g.STDOUT,u)}),F(()=>{const a=()=>{s(!1)};return i.socket.io.on("open",a),()=>{i.socket.io.off("open",a)}}),T(()=>{i.socket.emit("unlog"),h.off(g.STDOUT,u)}),()=>e(w,{darkMode:!0,onReady:a=>{l=a,n(l)}},null)}});var Y=f({setup(){const s=C(),l=L(()=>s.query.tab?.toString()||"0"),o=S();return()=>e(R,null,{default:()=>[e(V,{size:"medium",value:l.value,onUpdateValue:u=>{o.replace({...s,query:{...s.query,tab:u}})}},{default:()=>[e(x,{tab:"\u65E5\u5FD7",name:"0"},{default:()=>[e(B,null,null)]}),e(x,{tab:"\u5B9E\u65F6",name:"1"},{default:()=>[e(q,null,null)]})]})]})}});export{Y as default};
