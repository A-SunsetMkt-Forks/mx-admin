import{d as H,al as K,u as W,r as p,X as $,w,a$ as V,H as j,h as e,bo as G,U as N,bh as Q,bB as T,G as I,F as X,J as l,I as Y,bL as Z,L as v,bM as ee,bN as z,bO as ue,bP as h,O as ae,bQ as te,bR as ne,bS as se,bT as le,a1 as P,b1 as re}from"./vendor-a7b34205.js";import{H as E}from"./rounded-button-e182bc33.js";import{R as d,u as ie,d as oe,a as ce,I as pe,W as b,b as S,U as ve}from"./index-66557411.js";import{T as de}from"./index-bfc15a67.js";import{u as me}from"./use-table-86e8e7b0.js";const ye=["(\u0E51\u2022\u0300\u3142\u2022\u0301)\u0648\u2727","(\xB0\u30FC\xB0\u3003)","o(\uFFE3\u30D8\uFFE3o\uFF03)","(\u0E51\xAF\u25E1\xAF\u0E51)","( \u2022\u0300 .\u032B \u2022\u0301 )\u2727","(\u3064\u0434\u2282)","(o\xB4\u03C9`o)","(\u2022\u0C6A\u2022 )","(>\u25BD<)","(\u0E51\u2022\u0300\u3142\u2022\u0301) \u2727","\u10DA(\u2579\u25E1\u2579\u10DA)","_(:\u0437\u300D\u2220)_","\u053E\u2038\u053E"," \u0295 \u2022\u0300 o \u2022\u0301 \u0294"," (\u2449\uFF65\u0306\u2313\uFF65\u0306\u2449)"," \u266B.(\u25D5\u2220\u25D5).\u266B"," | \u2022\u0301 \u25BE \u2022\u0300 |"," \u3033 \xB0 \u25BE \xB0 \u3035"," | \u2022\u0301 \u25BE \u2022\u0300 |"," \u22CB\u254F \u275B \u25E1 \u275B \u254F\u22CC"," (\u30FB\u2200\u30FB)"," (^\u30FB\u03C9\u30FB^ )","(\xB4\uFF65\u03C9\uFF65`)  ","(\u0E51\xB4\u3142`\u0E51) ","(\u0E51\u02D8 \u2083\u02D8\u0E51) ","(\u25CF\u2019\u03C9`\u25CF\uFF09","(\xB4\uFF65\u03C9\uFF65`)  "];var D=(t=>(t[t.Unread=0]="Unread",t[t.Read=1]="Read",t[t.Junk=2]="Junk",t))(D||{});const he=H(()=>{const t=K(),U=W(),r=p(+t.query.state),{data:q,checkedRowKeys:i,fetchDataFn:_,pager:M,loading:C}=me((u,a)=>async(s=t.query.page||1,f=10)=>{const F=t.query.state,R=await d.api.comments.get({params:{page:s,size:f,state:F|0}});u.value=R.data,a.value=R.pagination}),g=$(),m=p(!1),n=p(null),o=p(""),x=p(),B=p(!1),A=async()=>{if(!!n.value)try{B.value=!0,await d.api.comments.master.reply(n.value.id).post({data:{text:o.value}}),m.value=!1,n.value=null,g.success("\u56DE\u590D\u6210\u529F\u5566~"),o.value="",await c()}finally{B.value=!1}},c=_;w(()=>t.query.page,async u=>{await c(u)},{immediate:!0}),w(()=>t.query.state,async u=>{await c()});async function y(u,a){Array.isArray(u)?await Promise.all(u.map(s=>d.api.comments(s).patch({data:{state:a}}))):await d.api.comments(u).patch({data:{state:a}}),g.success("\u64CD\u4F5C\u5B8C\u6210"),await c()}async function k(u){if(Array.isArray(u))try{await Promise.all(u.map(a=>d.api.comments(a).delete({errorHandler:s=>{}})))}catch{}else await d.api.comments(u).delete();await c(),g.success("\u5220\u9664\u6210\u529F")}const L=V([{title:"",key:"avatar",width:60,render(u){return e(le,{circle:!0,src:u.avatar})}},{title:"\u4F5C\u8005",key:"author",width:200,render(u,a){return e(v,{vertical:!0,size:2},e("a",{href:u.url||"#",target:"_blank",rel:"noreferrer"},u.author),e("a",{href:"mailto:"+u.mail||"",target:"_blank"},u.mail),e("div",null,e(pe,{ip:u.ip,trigger:"hover",triggerEl:e(P,{depth:"3",class:"select-all"},u.ip)})))}},{title:"\u5185\u5BB9",key:"text",render(u){const a=(()=>{switch(u.refType){case"Post":return b+"/posts/"+u.ref.category.slug+"/"+u.ref.slug;case"Note":return b+"/notes/"+u.ref.nid;case"Page":return b+"/"+u.ref.slug}})();return e(v,{vertical:!0,size:2},e(v,{size:5},e("span",null,S(u.created)),e("span",null,"\u4E8E"),e("a",{href:a,target:"_blank"},u.ref.title)),e("p",null,u.text),u.parent&&e("blockquote",{class:"border-l-[3px] border-solid border-primary-default pl-[12px] my-2 ml-4"},e(v,{size:2,align:"center"},e(P,{depth:"2"},u.parent.author,"\xA0\u5728\xA0",S(u.parent.created),"\xA0\u8BF4:\xA0",u.parent.text))),!C.value&&e("div",{class:"space-x-3"},r.value!==1&&e(l,{text:!0,size:"tiny",type:"success",onClick:()=>y(u.id,1)},"\u5DF2\u8BFB"),r.value!==2&&e(l,{text:!0,size:"tiny",type:"warning",onClick:()=>y(u.id,2)},"\u5783\u573E"),r.value!==2&&e(l,{text:!0,size:"tiny",type:"info",onClick:s=>{n.value=u,m.value=!0}},"\u56DE\u590D"),e(re,{positiveText:"\u53D6\u6D88",negativeText:"\u5220\u9664",onNegativeClick:()=>{k(u.id)}},{trigger:()=>e(l,{text:!0,size:"tiny",type:"error"},"\u5220\u9664"),default:()=>e("span",{class:"max-w-48"},"\u786E\u5B9A\u8981\u5220\u9664 ",u.title," ?")})))}}]),J=j(),{viewport:O}=ie(ve);return()=>e(ce,{actionsElement:e(ae,null,r.value!==1&&e(E,{name:"\u5DF2\u8BFB",icon:e(te,null),variant:"success",onClick:()=>{y(i.value,D.Read),i.value.length=0}}),r.value!==2&&e(E,{name:"\u6807\u8BB0\u4E3A\u5783\u573E",icon:e(ne,null),variant:"warning",onClick:()=>{y(i.value,D.Junk),i.value.length=0}}),e(E,{name:"\u5220\u9664",icon:e(se,null),variant:"error",onClick:()=>{J.warning({title:"\u8B66\u544A",content:"\u4F60\u786E\u5B9A\u8981\u5220\u9664\u591A\u6761\u8BC4\u8BBA\uFF1F",negativeText:"\u786E\u5B9A",positiveText:"\u4E0D\u786E\u5B9A",onNegativeClick:async()=>{await k(i.value),i.value.length=0}})}}))},e(ue,{size:"medium",value:r.value,onUpdateValue:u=>{U.replace({name:oe.Comment,query:{state:u}}).then(()=>{r.value=u})}},e(h,{name:0,tab:"\u672A\u8BFB"},e("div",{class:""})),e(h,{name:1,tab:"\u5DF2\u8BFB"},e("div",{class:""})),e(h,{name:2,tab:"\u5783\u573E"},e("div",{class:""}))),e(de,{maxWidth:600,data:q,loading:C.value,onFetchData:c,pager:M,onUpdateCheckedRowKeys:u=>{i.value=u},columns:[{type:"selection",options:["none","all"],width:30},...L]}),e(G,{transformOrigin:"center",show:!!m.value,onUpdateShow:u=>{u||(m.value=u)}},n.value&&e(N,{style:"width: 500px;max-width: 90vw",headerStyle:{textAlign:"center"},title:"\u56DE\u590D: "+n.value.author},e(Q,{onSubmit:A},e(T,{label:n.value.author+" \u8BF4:"},e(I,{disabled:!0,value:n.value.text,type:"textarea",autosize:{minRows:4,maxRows:10}})),e(T,{label:"\u56DE\u590D\u5185\u5BB9"},e(I,{ref:x,value:o.value,type:"textarea",onInput:u=>o.value=u,autosize:{minRows:4,maxRows:10}})),e("div",{class:"flex justify-between"},e(X,{trigger:"click",placement:O.value.mobile?"top-end":"left"},{trigger(){return e(l,{text:!0,class:"text-[20px]"},e(Y,null,e(Z,null)))},default(){return e(N,{style:"max-width: 300px",bordered:!1},e(v,{align:"center",class:"!justify-between"},ye.map(u=>e(l,{text:!0,key:u,type:"primary",onClick:()=>{if(!x.value)return;const a=ee(x.value).textareaElRef;a.focus(),z(()=>{const s=a.selectionStart,f=a.selectionEnd;a.value=a.value.substring(0,s)+` ${u} `+a.value.substring(f,a.value.length),o.value=a.value,z(()=>{const F=s+u.length+2;a.selectionStart=F,a.selectionEnd=F,a.focus()})})}},u))))}}),e(v,{size:12,align:"center",inline:!0},e(l,{type:"success",onClick:A,round:!0,loading:B.value},"\u786E\u5B9A"),e(l,{onClick:()=>{o.value="",m.value=!1},round:!0},"\u53D6\u6D88")))))))});export{he as default};
