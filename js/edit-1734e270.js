import{H as F}from"./rounded-button-e182bc33.js";import{E as x}from"./toggle-e7c686f7.js";import{l as C,R as f,i as D,a as R,d as P}from"./index-66557411.js";import{d as g,H as B,h as a,r as y,J as k,G as p,O as w,al as A,u as G,a$ as N,t as q,o as S,bh as V,ba as i,bb as H,bf as M,bU as T,be as L}from"./vendor-a7b34205.js";import{u as O}from"./use-parse-payload-ee448945.js";import"./use-react-1ab208ae.js";import"./use-save-confirm-3e742716.js";const U="https://api.github.com/",W=(l,s)=>fetch(`${U}repos/${l}/${s}`).then(u=>u.json()),_=(l,s)=>fetch(`${U}repos/${l}/${s}/readme`).then(u=>u.json()).catch(u=>null).then(u=>{if(u){const m=(()=>{const t=u.download_url.split("/"),r=t.pop(),c=t.pop();return`https://fastly.jsdelivr.net/gh/${l}/${s}@${c}/${r}`})();return fetch(m).then(t=>t.text())}return null}),J=g({props:{onData:{type:Function,required:!0},defaultValue:{type:String}},setup(l){const s=B(),u=()=>{const m=s.create({title:"\u4ECE Github \u89E3\u6790",content:()=>{const t=g({setup(){const r=y(l.defaultValue??""),c=y(!1),h=async()=>{c.value=!0;const o=r.value.replace(/\.git$/,"").replace(/^https?:\/\/github.com\//,""),[n,d]=o.split("/"),[v,b]=await Promise.all([W(n,d),_(n,d)]);l.onData(v,b),c.value=!1,requestAnimationFrame(()=>{m.destroy()})};return()=>a(w,null,a(p,{onKeydown:e=>{e.code==="Enter"&&h()},class:"my-4",value:r.value,placeholder:"\u5728\u6B64\u8F93\u5165\u9879\u76EE\u5730\u5740",onUpdateValue:e=>void(r.value=e)}),a("div",{class:"flex space-x-4 justify-end"},a(k,{type:"primary",round:!0,onClick:h,loading:c.value},"\u83B7\u53D6")))}});return a(t,null)}})};return()=>a(F,{color:"#25292E",icon:a(C,null),name:"\u4ECE GitHub \u83B7\u53D6",onClick:u})}}),te=g({setup(){const l=A(),s=G(),u=()=>({name:"",previewUrl:"",docUrl:"",projectUrl:"",images:[],description:"",avatar:"",text:"",id:void 0}),m=e=>O(t)(e),t=N(u()),r=q(()=>l.query.id);S(async()=>{const e=r.value;if(e&&typeof e=="string"){const n=(await f.api.projects(e).get({})).data;m(n)}});const c=async()=>{const e=()=>{try{if(!t.text||t.text.trim().length==0)throw"\u5185\u5BB9\u4E3A\u7A7A";return{...T(L(t),(o,n,d)=>(o[d]=typeof n>"u"?null:typeof n=="string"&&n.length==0?"":n,o)),text:t.text.trim()}}catch(o){throw message.error(o),o}};if(r.value){if(!M(r.value))return;const o=r.value;await f.api.projects(o).put({data:e()}),message.success("\u4FEE\u6539\u6210\u529F")}else await f.api.projects.post({data:e()}),message.success("\u53D1\u5E03\u6210\u529F");s.push({name:P.ListProject})},h=(e,o)=>{const{html_url:n,homepage:d,description:v}=e;Object.assign(t,{description:v,projectUrl:n,previewUrl:d,images:(j=>{const I=/(?<=!\[.*\]\()(.+)(?=\))/g,E=[];for(const $ of j.matchAll(I))E.push($[0]);return E})(o||""),name:e.name,text:o||""})};return()=>a(R,{actionsElement:a(w,null,a(J,{onData:h,defaultValue:t.projectUrl}),a(F,{variant:"primary",onClick:c,icon:a(D,null)}))},a(V,{labelWidth:"7rem",labelPlacement:"left",labelAlign:"left"},a(i,{label:"\u9879\u76EE\u540D\u79F0",required:!0},a(p,{autofocus:!0,placeholder:"",value:t.name,onInput:e=>void(t.name=e)})),a(i,{label:"\u6587\u6863\u5730\u5740"},a(p,{placeholder:"",value:t.docUrl,onInput:e=>void(t.docUrl=e)})),a(i,{label:"\u9884\u89C8\u5730\u5740"},a(p,{placeholder:"",value:t.previewUrl,onInput:e=>void(t.previewUrl=e)})),a(i,{label:"\u9879\u76EE\u5730\u5740"},a(p,{placeholder:"",value:t.projectUrl,onInput:e=>void(t.projectUrl=e)})),a(i,{label:"\u9879\u76EE\u63CF\u8FF0",required:!0},a(p,{placeholder:"",value:t.description,onInput:e=>void(t.description=e)})),a(i,{label:"\u9879\u76EE\u56FE\u6807"},a(p,{placeholder:"",value:t.avatar,onInput:e=>void(t.avatar=e)})),a(i,{label:"\u9884\u89C8\u56FE\u7247"},a(H,{round:!0,value:t.images,onUpdateValue:e=>void(t.images=e)})),a(i,{label:"\u6B63\u6587",required:!0},a("div",{class:"w-full"},a(x,{unSaveConfirm:!1,class:"h-80 w-full",loading:!!(r.value&&!t.id),onChange:e=>{t.text=e},text:t.text})))))}});export{te as default};
