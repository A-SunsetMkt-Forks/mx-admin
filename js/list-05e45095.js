import{R as o,A as D,a as T}from"./index-66557411.js";import{T as h}from"./title-link-b7884d48.js";import{D as k}from"./delete-confirm-93a73628.js";import{T as v}from"./index-bfc15a67.js";import{R as d}from"./relative-time-926545d3.js";import{u as B}from"./use-table-86e8e7b0.js";import{d as c,X as w,al as E,w as C,o as O,a$ as P,h as t,b1 as R,J as b,L as x,O as L}from"./vendor-a7b34205.js";import{H as A}from"./rounded-button-e182bc33.js";const z=c({name:"PageList",setup(){const{checkedRowKeys:u,data:p,pager:i,sortProps:s,fetchDataFn:m}=B((a,e)=>async(f=l.query.page||1,y=20)=>{const F=await o.api.pages.get({params:{page:f,size:y,select:"title subtitle _id id created modified slug",...s.sortBy?{sortBy:s.sortBy,sortOrder:s.sortOrder}:{}}});a.value=F.data}),n=w(),l=E(),r=m;C(()=>l.query.page,async a=>{await r(a)}),O(async()=>{await r()});const g=c({setup(){const a=P([{type:"selection",options:["none","all"]},{title:"\u6807\u9898",sortOrder:!1,sorter:"default",key:"title",width:300,render(e){return t(h,{inPageTo:"/pages/edit?id="+e.id,title:e.title,externalLinkTo:"/"+e.slug,id:e.id})}},{title:"\u526F\u6807\u9898",key:"subtitle"},{title:"\u8DEF\u5F84",key:"slug",render(e){return"/"+e.slug}},{title:"\u521B\u5EFA\u4E8E",key:"created",sortOrder:"descend",sorter:"default",render(e){return t(d,{time:e.created})}},{title:"\u4FEE\u6539\u4E8E",key:"modified",sorter:"default",sortOrder:!1,render(e){return t(d,{time:e.modified})}},{title:"\u64CD\u4F5C",fixed:"right",key:"id",render(e){return t(x,null,t(R,{positiveText:"\u53D6\u6D88",negativeText:"\u5220\u9664",onNegativeClick:async()=>{await o.api.pages(e.id).delete(),n.success("\u5220\u9664\u6210\u529F"),await r(i.value.currentPage)}},{trigger:()=>t(b,{text:!0,type:"error",size:"tiny"},"\u79FB\u9664"),default:()=>t("span",{class:"max-w-48"},"\u786E\u5B9A\u8981\u5220\u9664 ",e.title," ?")}))}}]);return()=>t(v,{noPagination:!0,columns:a,data:p,onFetchData:r,pager:i,onUpdateCheckedRowKeys:e=>{u.value=e},onUpdateSorter:async e=>{s.sortBy=e.sortBy,s.sortOrder=e.sortOrder}})}});return()=>t(T,null,{actions:()=>t(L,null,t(k,{checkedRowKeys:u.value,onDelete:async()=>{const a=await Promise.allSettled(u.value.map(e=>o.api.pages(e).delete()));for(const e of a)e.status==="rejected"&&n.success("\u5220\u9664\u5931\u8D25\uFF0C"+e.reason.message);u.value.length=0,r()}}),t(A,{to:"/pages/edit",icon:t(D,null)})),default:()=>t(g,null)})}});export{z as ManagePageListView};
