import{d as l,R as i,u as F,q as v,f as w,w as x,j as k,l as C,h as t,p,N as d,a as R,F as B,A as T,m as E}from"./index-deb90793.js";import{D as N}from"./delete-confirm-a038dc4b.js";import{T as A}from"./index-95171ce1.js";import{R as S}from"./relative-time-c51f9f7d.js";import{u as L}from"./use-table-58090fc7.js";import{H as M}from"./rounded-button-11cc7b25.js";import{N as b}from"./Popconfirm-d3e46339.js";import"./DataTable-46f2ff83.js";import"./Icon-61674078.js";import"./Select-85b670fe.js";import"./Tag-5d98a870.js";import"./Forward-e8fa8258.js";import"./index-0727585f.js";import"./ChevronRight-1702a94e.js";import"./Tooltip-814e9858.js";const Z=l({name:"SayList",setup(q,K){const{checkedRowKeys:u,data:m,pager:o,loading:y,fetchDataFn:f}=L((a,e)=>async(h=n.query.page||1,D=30)=>{const c=await i.api.says.get({params:{page:h,size:D,select:"title text _id id created modified author source"}});a.value=c.data,e.value=c.pagination}),r=F();v();const n=w(),s=f;x(()=>n.query.page,async a=>{await s(a)}),k(async()=>{await s()});const g=l({setup(){const a=C([{type:"selection",options:["none","all"]},{title:"\u521B\u5EFA\u4E8E",key:"created",width:100,render(e){return t(p,{to:"/says/edit?id="+e.id},t(S,{time:e.created}))}},{title:"\u5185\u5BB9",key:"text"},{title:"\u4F5C\u8005",key:"author"},{title:"\u6765\u6E90",key:"source"},{title:"\u64CD\u4F5C",fixed:"right",key:"id",width:130,render(e){return t(R,{wrap:!1},t(p,{to:"/says/edit?id="+e.id},t(d,{text:!0,type:"primary",size:"tiny"},"\u7F16\u8F91")),t(b,{positiveText:"\u53D6\u6D88",negativeText:"\u5220\u9664",onNegativeClick:async()=>{await i.api.says(e.id).delete(),r.success("\u5220\u9664\u6210\u529F"),await s(o.value.currentPage)}},{trigger:()=>t(d,{text:!0,type:"error",size:"tiny"},"\u79FB\u9664"),default:()=>t("span",{class:"max-w-48"},"\u786E\u5B9A\u8981\u5220\u9664\u201C",e.text,"\u201D ?")}))}}]);return()=>t(A,{loading:y.value,columns:a,data:m,onFetchData:s,pager:o,onUpdateCheckedRowKeys:e=>{u.value=e}})}});return()=>t(E,null,{actions:()=>t(B,null,t(N,{checkedRowKeys:u.value,onDelete:async()=>{const a=await Promise.allSettled(u.value.map(e=>i.api.says(e).delete()));for(const e of a)e.status==="rejected"&&r.success("\u5220\u9664\u5931\u8D25\uFF0C"+e.reason.message);u.value.length=0,s()}}),t(M,{to:"/says/edit",icon:t(T,null)})),default:()=>t(g,null)})}});export{Z as default};
