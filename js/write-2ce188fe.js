import{d as h,al as x,o as y,a$ as P,t as E,r as n,X as T,u as U,h as t,ba as d,b8 as w,bb as k,G as A,bc as D,O as C,T as M,I as N,bd as V,be as $,bf as W}from"./vendor-a7b34205.js";import{H}from"./rounded-button-e182bc33.js";import{T as q,M as j,P as z}from"./parse-content-b2d97682.js";import{E as L}from"./toggle-e7c686f7.js";import{u as O,R as m,W as G,a as X,C as Y,d as _}from"./index-66557411.js";import{U as J}from"./underline-input-c7f2e7f0.js";import"./js-yaml-fae8e8ce.js";import"./use-react-1ab208ae.js";import"./use-save-confirm-3e742716.js";const oa=h(()=>{const I=x(),o=O(Y);y(async()=>{await o.fetch()});const S=()=>({categoryId:o.data?.value?.[0].id??"",slug:"",text:"",title:"",copyright:!0,tags:[],summary:"",allowComment:!0,id:void 0,images:[]}),B=a=>{const u=$(e),r=Object.keys(u);for(const s in a)r.includes(s)&&(e[s]=a[s])},e=P(S()),l=E(()=>I.query.id),p=E(()=>o.get(e.categoryId)||o.data?.value?.[0]||{});y(async()=>{const a=l.value;if(a&&typeof a=="string"){const u=await m.api.posts(a).get();B(u.data)}});const g=n(!1),f=T(),R=U(),F=async()=>{const a={...e,categoryId:p.value.id,summary:e.summary&&e.summary.trim()!=""?e.summary.trim():null};if(l.value){if(!W(l.value))return;const u=l.value;await m.api.posts(u).put({data:a}),f.success("\u4FEE\u6539\u6210\u529F")}else await m.api.posts.post({data:a}),f.success("\u53D1\u5E03\u6210\u529F");R.push({name:_.ViewPost,hash:"|publish"})};return()=>t(X,{title:l.value?"\u4FEE\u6539\u6587\u7AE0":"\u64B0\u5199\u65B0\u6587\u7AE0",actionsElement:t(C,null,t(z,{data:e,onHandleYamlParsedMeta:a=>{e.title=a.title??e.title,e.slug=a.slug??e.slug}}),t(H,{icon:t(M,null),onClick:F})),footerButtonElement:t(C,null,t("button",{onClick:()=>{g.value=!0}},t(N,null,t(V,null))))},t(j,{class:"mt-3 relative z-10",label:"\u60F3\u60F3\u53D6\u4E2A\u4EC0\u4E48\u6807\u9898\u597D\u5462~",value:e.title,onChange:a=>{e.title=a}}),t("div",{class:"text-gray-500 py-3"},t("label",{class:"prefix"},`${G}/${p.value.slug}/`),t(J,{class:"ml-2",value:e.slug,onChange:a=>{e.slug=a}})),t(L,{loading:!!(l.value&&typeof e.id>"u"),onChange:a=>{e.text=a},text:e.text}),t(q,{show:g.value,onUpdateShow:a=>{g.value=a},data:e},t(d,{label:"\u5206\u7C7B",required:!0,path:"category"},t(w,{placeholder:"\u8BF7\u9009\u62E9",value:p.value.id,onUpdateValue:a=>{e.categoryId=a},options:o.data.value?.map(a=>({label:a.name,value:a.id,key:a.id}))||[]})),t(d,{label:"\u6807\u7B7E"},t(k,{value:e.tags,onUpdateValue:a=>{e.tags.length=0,e.tags.push(...a)}},{input({submit:a}){const u=h({setup(){const r=n([]),s=n(!1),b=n(""),v=n();return y(async()=>{s.value=!0,v.value&&v.value.$el.querySelector("input").focus();const{data:i}=await m.api.categories.get({params:{type:"Tag"}});r.value=i.map(c=>({label:c.name+" ("+c.count+")",value:c.name,key:c.name})),s.value=!1}),()=>t(w,{ref:v,size:"small",value:b.value,clearable:!0,loading:s.value,filterable:!0,tag:!0,options:r.value,onUpdateValue:i=>{b.value=i,a(i)}})}});return t(u,null)}})),t(d,{label:"\u6982\u8981"},t(A,{placeholder:"\u6587\u7AE0\u6982\u8981",value:e.summary,onInput:a=>void(e.summary=a)})),t(d,{label:"\u7248\u6743\u6CE8\u660E",labelWidth:100,labelAlign:"right",labelPlacement:"left"},t(D,{value:e.copyright,onUpdateValue:a=>void(e.copyright=a)}))))});export{oa as default};
