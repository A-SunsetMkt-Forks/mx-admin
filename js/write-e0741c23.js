import{d as E,f as R,i as k,j as y,l as x,k as b,R as c,v as r,u as P,t as U,h as t,y as T,W as A,F as w,bh as D,I as M,m as V,C as W,bi as $,bj as j}from"./index-7e4abaa4.js";import{H}from"./rounded-button-082a5d75.js";import{T as q,M as z,P as L,S as O}from"./parse-content-ad428e7a.js";import{E as Y}from"./toggle-4a83b960.js";import{U as _}from"./underline-input-8a735fac.js";import{N as G}from"./DynamicTags-9e9be782.js";import{i as J}from"./isString-abfa9320.js";import{N as p}from"./FormItem-f13e1cd5.js";import{N as C}from"./Select-6e34ede7.js";import{N as K}from"./Switch-4e7230c3.js";import"./Form-77af3073.js";import"./CollapseItem-562f7adf.js";import"./ChevronRight-6c0d4f97.js";import"./InputNumber-1e4127d4.js";import"./Add-cbde1fd4.js";import"./js-yaml-fae8e8ce.js";import"./use-react-8c6f4029.js";import"./use-save-confirm-74164de5.js";import"./throttle-5c3590fd.js";import"./Tag-1d6bc2b4.js";import"./index-47d73072.js";const ha=E(()=>{const I=R(),l=k(W);y(async()=>{await l.fetch()});const S=()=>({categoryId:l.data?.value?.[0].id??"",slug:"",text:"",title:"",copyright:!0,tags:[],summary:"",allowComment:!0,id:void 0,images:[]}),B=a=>{const u=$(e),n=Object.keys(u);for(const o in a)n.includes(o)&&(e[o]=a[o])},e=x(S()),s=b(()=>I.query.id),d=b(()=>l.get(e.categoryId)||l.data?.value?.[0]||{});y(async()=>{const a=s.value;if(a&&typeof a=="string"){const u=await c.api.posts(a).get();B(u.data)}});const g=r(!1),f=P(),F=U(),N=async()=>{const a={...e,categoryId:d.value.id,summary:e.summary&&e.summary.trim()!=""?e.summary.trim():null};if(s.value){if(!J(s.value))return;const u=s.value;await c.api.posts(u).put({data:a}),f.success("\u4FEE\u6539\u6210\u529F")}else await c.api.posts.post({data:a}),f.success("\u53D1\u5E03\u6210\u529F");F.push({name:j.ViewPost,hash:"|publish"})};return()=>t(V,{title:s.value?"\u4FEE\u6539\u6587\u7AE0":"\u64B0\u5199\u65B0\u6587\u7AE0",actionsElement:t(w,null,t(L,{data:e,onHandleYamlParsedMeta:a=>{e.title=a.title??e.title,e.slug=a.slug??e.slug}}),t(H,{icon:t(D,null),onClick:N})),footerButtonElement:t(w,null,t("button",{onClick:()=>{g.value=!0}},t(M,null,t(O,null))))},t(z,{class:"mt-3 relative z-10",label:"\u60F3\u60F3\u53D6\u4E2A\u4EC0\u4E48\u6807\u9898\u597D\u5462~",value:e.title,onChange:a=>{e.title=a}}),t("div",{class:"text-gray-500 py-3"},t("label",{class:"prefix"},`${A}/${d.value.slug}/`),t(_,{class:"ml-2",value:e.slug,onChange:a=>{e.slug=a}})),t(Y,{loading:!!(s.value&&typeof e.id>"u"),onChange:a=>{e.text=a},text:e.text}),t(q,{show:g.value,onUpdateShow:a=>{g.value=a},data:e},t(p,{label:"\u5206\u7C7B",required:!0,path:"category"},t(C,{placeholder:"\u8BF7\u9009\u62E9",value:d.value.id,onUpdateValue:a=>{e.categoryId=a},options:l.data.value?.map(a=>({label:a.name,value:a.id,key:a.id}))||[]})),t(p,{label:"\u6807\u7B7E"},t(G,{value:e.tags,onUpdateValue:a=>{e.tags.length=0,e.tags.push(...a)}},{input({submit:a}){const u=E({setup(){const n=r([]),o=r(!1),h=r(""),v=r();return y(async()=>{o.value=!0,v.value&&v.value.$el.querySelector("input").focus();const{data:i}=await c.api.categories.get({params:{type:"Tag"}});n.value=i.map(m=>({label:m.name+" ("+m.count+")",value:m.name,key:m.name})),o.value=!1}),()=>t(C,{ref:v,size:"small",value:h.value,clearable:!0,loading:o.value,filterable:!0,tag:!0,options:n.value,onUpdateValue:i=>{h.value=i,a(i)}})}});return t(u,null)}})),t(p,{label:"\u6982\u8981"},t(T,{placeholder:"\u6587\u7AE0\u6982\u8981",value:e.summary,onInput:a=>void(e.summary=a)})),t(p,{label:"\u7248\u6743\u6CE8\u660E",labelWidth:100,labelAlign:"right",labelPlacement:"left"},t(K,{value:e.copyright,onUpdateValue:a=>void(e.copyright=a)}))))});export{ha as default};
